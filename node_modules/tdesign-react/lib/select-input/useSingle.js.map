{"version":3,"file":"useSingle.js","sources":["../../src/select-input/useSingle.tsx"],"sourcesContent":["import React, { useRef, MouseEvent } from 'react';\nimport isObject from 'lodash/isObject';\nimport pick from 'lodash/pick';\nimport classNames from 'classnames';\nimport { SelectInputCommonProperties } from './interface';\nimport Input, { InputRef, TdInputProps } from '../input';\nimport { TdSelectInputProps } from './type';\nimport { Loading } from '../loading';\nimport useConfig from '../hooks/useConfig';\nimport useControlled from '../hooks/useControlled';\n\nexport interface RenderSelectSingleInputParams {\n  tPlaceholder: string;\n}\n\n// single 和 multiple 共有特性\nconst COMMON_PROPERTIES = [\n  'status',\n  'clearable',\n  'disabled',\n  'label',\n  'placeholder',\n  'readonly',\n  'suffix',\n  'suffixIcon',\n  'onPaste',\n  'onEnter',\n  'onMouseenter',\n  'onMouseleave',\n  'size',\n];\n\nconst DEFAULT_KEYS: TdSelectInputProps['keys'] = {\n  label: 'label',\n  value: 'value',\n};\n\nfunction getInputValue(value: TdSelectInputProps['value'], keys: TdSelectInputProps['keys']) {\n  const iKeys = keys || DEFAULT_KEYS;\n  return isObject(value) ? value[iKeys.label] : value;\n}\n\nexport default function useSingle(props: TdSelectInputProps) {\n  const { value, keys, loading } = props;\n  const { classPrefix } = useConfig();\n  const inputRef = useRef<InputRef>();\n  const [inputValue, setInputValue] = useControlled(props, 'inputValue', props.onInputChange);\n\n  const commonInputProps: SelectInputCommonProperties = {\n    ...pick(props, COMMON_PROPERTIES),\n    suffixIcon: loading ? <Loading loading size=\"small\" /> : props.suffixIcon,\n  };\n\n  const onInnerClear = (context: { e: MouseEvent<SVGSVGElement> }) => {\n    context?.e?.stopPropagation();\n    props.onClear?.(context);\n    setInputValue('', { trigger: 'clear' });\n  };\n\n  const onInnerInputChange: TdInputProps['onChange'] = (value, context) => {\n    if (props.allowInput) {\n      setInputValue(value, { ...context, trigger: 'input' });\n    }\n  };\n\n  const renderSelectSingle = (popupVisible: boolean) => {\n    // 单选，值的呈现方式\n    const singleValueDisplay = !props.multiple ? props.valueDisplay : null;\n    const displayedValue = popupVisible && props.allowInput ? inputValue : getInputValue(value, keys);\n    return (\n      <Input\n        ref={inputRef}\n        {...commonInputProps}\n        autoWidth={props.autoWidth}\n        placeholder={singleValueDisplay ? '' : props.placeholder}\n        value={singleValueDisplay ? ' ' : displayedValue}\n        label={\n          <>\n            {props.label}\n            {singleValueDisplay}\n          </>\n        }\n        onChange={onInnerInputChange}\n        readonly={!props.allowInput}\n        onClear={onInnerClear}\n        // [Important Info]: SelectInput.blur is not equal to Input, example: click popup panel\n        onFocus={(val, context) => {\n          props.onFocus?.(value, { ...context, inputValue: val });\n          // focus might not need to change input value. it will caught some curious errors in tree-select\n          // !popupVisible && setInputValue(getInputValue(value, keys), { ...context, trigger: 'input' });\n        }}\n        onEnter={(val, context) => {\n          props.onEnter?.(value, { ...context, inputValue: val });\n        }}\n        {...props.inputProps}\n        inputClass={classNames(props.inputProps?.className, {\n          [`${classPrefix}-input--focused`]: popupVisible,\n          [`${classPrefix}-is-focused`]: popupVisible,\n        })}\n      />\n    );\n  };\n\n  return {\n    inputRef,\n    commonInputProps,\n    singleInputValue: inputValue,\n    onInnerClear,\n    renderSelectSingle,\n  };\n}\n"],"names":["COMMON_PROPERTIES","DEFAULT_KEYS","label","value","getInputValue","keys","iKeys","isObject","useSingle","props","loading","_useConfig","useConfig","classPrefix","inputRef","useRef","_useControlled","useControlled","onInputChange","_useControlled2","_slicedToArray","inputValue","setInputValue","commonInputProps","_objectSpread","pick","suffixIcon","React","createElement","Loading","size","onInnerClear","context","_context$e","_props$onClear","e","stopPropagation","onClear","call","trigger","onInnerInputChange","allowInput","renderSelectSingle","popupVisible","_props$inputProps","singleValueDisplay","multiple","valueDisplay","displayedValue","Input","ref","autoWidth","placeholder","Fragment","onChange","readonly","onFocus","val","_props$onFocus","onEnter","_props$onEnter","inputProps","inputClass","classNames","className","_defineProperty","concat","singleInputValue"],"mappings":"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"}