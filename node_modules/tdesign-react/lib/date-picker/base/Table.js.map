{"version":3,"file":"Table.js","sources":["../../../src/date-picker/base/Table.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\nimport classNames from 'classnames';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport useConfig from '../../hooks/useConfig';\nimport DatePickerCell from './Cell';\nimport { TdDatePickerProps } from '../type';\nimport { SinglePanelProps } from '../panel/SinglePanel';\nimport { PanelContentProps } from '../panel/PanelContent';\nimport { parseToDayjs } from '../../_common/js/date-picker/format';\n\nexport interface DatePickerTableProps\n  extends Pick<TdDatePickerProps, 'mode' | 'firstDayOfWeek' | 'format'>,\n    Pick<SinglePanelProps, 'onCellClick' | 'onCellMouseEnter' | 'onCellMouseLeave'>,\n    Pick<PanelContentProps, 'value'> {\n  data?: Array<any>;\n  time?: string;\n}\n\nconst DatePickerTable = (props: DatePickerTableProps) => {\n  const { classPrefix } = useConfig();\n\n  const { value, format, mode, data, time, onCellClick, onCellMouseEnter, onCellMouseLeave, firstDayOfWeek } = props;\n\n  const [local, t] = useLocaleReceiver('datePicker');\n  const weekdays = t(local.weekdays);\n  const weekAbbreviation = t(local.weekAbbreviation);\n\n  const weekArr = [];\n  let wi = firstDayOfWeek - 1;\n  const len = weekdays.length;\n  while (weekArr.length < len) {\n    weekArr.push(weekdays[wi]);\n    wi = (wi + len + 1) % len;\n  }\n  if (mode === 'week') weekArr.unshift(weekAbbreviation);\n\n  const showThead = mode === 'date' || mode === 'week';\n\n  const valueYearWeek = useMemo(() => {\n    if (mode !== 'week' || !value) return {};\n\n    if (Array.isArray(value)) {\n      if (!value.length) return {};\n      const [startObj, endObj] = value.map((v) => v && parseToDayjs(v, format));\n      const startYear = startObj?.year?.();\n      const startWeek = startObj?.locale?.(local.dayjsLocale)?.week?.();\n      const endYear = endObj?.year?.();\n      const endWeek = endObj?.locale?.(local.dayjsLocale)?.week?.();\n\n      return { startYear, startWeek, endYear, endWeek };\n    }\n\n    const valueObj = parseToDayjs(value, format).locale(local.dayjsLocale);\n    return { year: valueObj.year(), week: valueObj.week() };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [mode, value, format]);\n\n  // 高亮周区间\n  const weekRowClass = (value, targetDayjs) => {\n    if (mode !== 'week' || !value) return {};\n\n    if (Array.isArray(value)) {\n      if (!value.length) return {};\n\n      const targetYear = targetDayjs.year();\n      const targetWeek = targetDayjs.week();\n      const isActive =\n        (targetYear === valueYearWeek.startYear && targetWeek === valueYearWeek.startWeek) ||\n        (targetYear === valueYearWeek.endYear && targetWeek === valueYearWeek.endWeek);\n      const isRange =\n        targetYear >= valueYearWeek.startYear &&\n        targetYear <= valueYearWeek.endYear &&\n        targetWeek > valueYearWeek.startWeek &&\n        targetWeek < valueYearWeek.endWeek;\n      return {\n        // 同年同周\n        [`${classPrefix}-date-picker__table-${mode}-row--active`]: isActive,\n        [`${classPrefix}-date-picker__table-${mode}-row--range`]: isRange,\n      };\n    }\n\n    return {\n      [`${classPrefix}-date-picker__table-${mode}-row--active`]:\n        valueYearWeek.year === targetDayjs.year() && valueYearWeek.week === targetDayjs.week(),\n    };\n  };\n\n  return (\n    <div className={`${classPrefix}-date-picker__table`} onMouseLeave={(e) => onCellMouseLeave?.({ e })}>\n      <table>\n        {showThead && (\n          <thead>\n            <tr>\n              {weekArr.map((value: string, i: number) => (\n                <th key={i}>{value}</th>\n              ))}\n            </tr>\n          </thead>\n        )}\n        <tbody>\n          {data.map((row, i: number) => (\n            <tr\n              key={i}\n              className={classNames(`${classPrefix}-date-picker__table-${mode}-row`, {\n                ...weekRowClass(value, row[0].dayjsObj),\n              })}\n            >\n              {row.map((col: any, j: number) => (\n                <DatePickerCell {...col} key={j} time={time} onClick={onCellClick} onMouseEnter={onCellMouseEnter} />\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n};\n\nDatePickerTable.displayName = 'DatePickerTable';\n\nexport default DatePickerTable;\n"],"names":["DatePickerTable","props","_useConfig","useConfig","classPrefix","value","format","mode","data","time","onCellClick","onCellMouseEnter","onCellMouseLeave","firstDayOfWeek","_useLocaleReceiver","useLocaleReceiver","_useLocaleReceiver2","_slicedToArray","local","t","weekdays","weekAbbreviation","weekArr","wi","len","length","push","unshift","showThead","valueYearWeek","useMemo","Array","isArray","_startObj$year","_startObj$locale","_startObj$locale$week","_endObj$year","_endObj$locale","_endObj$locale$week","_value$map","map","v","parseToDayjs","_value$map2","startObj","endObj","startYear","year","call","startWeek","locale","dayjsLocale","week","endYear","endWeek","valueObj","weekRowClass","targetDayjs","targetYear","targetWeek","isActive","isRange","_defineProperty","concat","React","createElement","className","onMouseLeave","e","i","key","row","classNames","_objectSpread","dayjsObj","col","j","DatePickerCell","onClick","onMouseEnter","displayName"],"mappings":"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"}