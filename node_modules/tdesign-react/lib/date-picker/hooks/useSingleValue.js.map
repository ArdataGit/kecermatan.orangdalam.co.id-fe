{"version":3,"file":"useSingleValue.js","sources":["../../../src/date-picker/hooks/useSingleValue.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport {\n  formatDate,\n  formatTime,\n  isValidDate,\n  getDefaultFormat,\n  parseToDayjs,\n} from '../../_common/js/date-picker/format';\nimport useControlled from '../../hooks/useControlled';\nimport { TdDatePickerProps } from '../type';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\nimport log from '../../_common/js/log';\n\nexport default function useSingleValue(props: TdDatePickerProps) {\n  const [value, onChange] = useControlled(props, 'value', props.onChange);\n\n  const { format, timeFormat } = getDefaultFormat({\n    mode: props.mode,\n    format: props.format,\n    enableTimePicker: props.enableTimePicker,\n  });\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(format))\n      log.error('DatePicker', `format: ${format} is invalid，time selection must include time formatting HH:mm:ss`);\n  }\n\n  const [time, setTime] = useState(formatTime(value, format, timeFormat, props.defaultTime));\n  const [month, setMonth] = useState<number>(parseToDayjs(value, format).month());\n  const [year, setYear] = useState<number>(parseToDayjs(value, format).year());\n  const [cacheValue, setCacheValue] = useState(formatDate(value, { format })); // 缓存选中值，panel 点击时更改\n\n  // 输入框响应 value 变化\n  useEffect(() => {\n    if (!value) {\n      setCacheValue('');\n      return;\n    }\n    if (!isValidDate(value, format)) return;\n\n    setCacheValue(formatDate(value, { format }));\n    setTime(formatTime(value, format, timeFormat, props.defaultTime));\n    // eslint-disable-next-line\n  }, [value]);\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    cacheValue,\n    onChange,\n    setYear,\n    setMonth,\n    setTime,\n    setCacheValue,\n  };\n}\n"],"names":["useSingleValue","props","_useControlled","useControlled","onChange","_useControlled2","_slicedToArray","value","_getDefaultFormat","getDefaultFormat","mode","format","enableTimePicker","timeFormat","extractTimeFormat","log","error","concat","_useState","useState","formatTime","defaultTime","_useState2","time","setTime","_useState3","parseToDayjs","month","_useState4","setMonth","_useState5","year","_useState6","setYear","_useState7","formatDate","_useState8","cacheValue","setCacheValue","useEffect","isValidDate"],"mappings":"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"}