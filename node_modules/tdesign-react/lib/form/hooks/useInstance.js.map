{"version":3,"file":"useInstance.js","sources":["../../../src/form/hooks/useInstance.tsx"],"sourcesContent":["import isEmpty from 'lodash/isEmpty';\nimport isFunction from 'lodash/isFunction';\nimport merge from 'lodash/merge';\nimport type {\n  TdFormProps,\n  FormValidateResult,\n  FormResetParams,\n  FormValidateMessage,\n  AllValidateResult,\n  NamePath,\n} from '../type';\nimport useConfig from '../../hooks/useConfig';\nimport { getMapValue, travelMapFromObject, calcFieldValue } from '../utils';\nimport log from '../../_common/js/log';\n\n// 检测是否需要校验 默认全量校验\nfunction needValidate(name: NamePath, fields: string[]) {\n  if (!fields || !Array.isArray(fields)) return true;\n  return fields.some((item) => String(item) === String(name));\n}\n\n// 整理校验结果\nfunction formatValidateResult(validateResultList) {\n  const result = validateResultList.reduce((r, err) => Object.assign(r || {}, err), {});\n  Object.keys(result).forEach((key) => {\n    if (result[key] === true) {\n      delete result[key];\n    } else {\n      result[key] = result[key].filter((fr: AllValidateResult) => fr.result === false);\n    }\n\n    // 整理嵌套数据\n    if (result[key] && key.includes('_')) {\n      const keyList = key.split('_');\n      const fieldValue = calcFieldValue(keyList, result[key]);\n      merge(result, fieldValue);\n      delete result[key];\n    }\n  });\n  return isEmpty(result) ? true : result;\n}\n\nexport default function useInstance(props: TdFormProps, formRef, formMapRef: React.MutableRefObject<Map<any, any>>) {\n  const { classPrefix } = useConfig();\n\n  const { scrollToFirstError, preventSubmitDefault = true, onSubmit, onReset } = props;\n\n  // 获取第一个错误表单\n  function getFirstError(r: FormValidateResult<FormData>) {\n    if (r === true) return;\n    const [firstKey] = Object.keys(r);\n    if (scrollToFirstError) {\n      scrollTo(`.${classPrefix}-form--has-error`);\n    }\n    return r[firstKey][0]?.message;\n  }\n\n  // 校验不通过时，滚动到第一个错误表单\n  function scrollTo(selector: string) {\n    const dom = formRef.current.querySelector?.(selector);\n    const behavior = scrollToFirstError as ScrollBehavior;\n    dom && dom.scrollIntoView({ behavior });\n  }\n\n  // 对外方法 手动提交表单\n  function submit(e?: React.FormEvent<HTMLFormElement>) {\n    if (preventSubmitDefault) {\n      e?.preventDefault?.();\n      e?.stopPropagation?.();\n    }\n    validate().then((r) => {\n      const firstError = getFirstError(r);\n      const fields = getFieldsValue(true);\n      onSubmit?.({ validateResult: r, firstError, e, fields });\n    });\n  }\n\n  // 对外方法，该方法会触发全部表单组件错误信息显示\n  async function validate(param?: Record<string, any>): Promise<FormValidateResult<FormData>> {\n    const { fields, trigger = 'all', showErrorMessage } = param || {};\n    const list = [...formMapRef.current.values()]\n      .filter(\n        (formItemRef) => isFunction(formItemRef?.current?.validate) && needValidate(formItemRef?.current?.name, fields),\n      )\n      .map((formItemRef) => formItemRef?.current.validate(trigger, showErrorMessage));\n\n    const validateList = await Promise.all(list);\n    return formatValidateResult(validateList);\n  }\n\n  // 对外方法，该方法只会校验不会触发信息提示\n  async function validateOnly(param?: Record<string, any>): Promise<FormValidateResult<FormData>> {\n    const { fields, trigger = 'all' } = param || {};\n    const list = [...formMapRef.current.values()]\n      .filter(\n        (formItemRef) =>\n          isFunction(formItemRef?.current?.validateOnly) && needValidate(formItemRef?.current?.name, fields),\n      )\n      .map((formItemRef) => formItemRef?.current.validateOnly?.(trigger));\n\n    const validateList = await Promise.all(list);\n    return formatValidateResult(validateList);\n  }\n\n  // 对外方法，获取对应 formItem 的值\n  function getFieldValue(name: NamePath) {\n    if (!name) return null;\n\n    const formItemRef = getMapValue(name, formMapRef);\n    return formItemRef?.current?.getValue?.();\n  }\n\n  // 对外方法，获取一组字段名对应的值，当调用 getFieldsValue(true) 时返回所有值\n  function getFieldsValue(nameList: string[] | boolean) {\n    const fieldsValue = {};\n\n    if (nameList === true) {\n      // 嵌套数组子节点先添加导致外层数据覆盖因而需要倒序遍历\n      for (const [name, formItemRef] of [...formMapRef.current.entries()].reverse()) {\n        const fieldValue = calcFieldValue(name, formItemRef?.current.getValue?.());\n        merge(fieldsValue, fieldValue);\n      }\n    } else {\n      if (!Array.isArray(nameList)) {\n        log.error('Form', '`getFieldsValue` 参数需要 Array 类型');\n        return {};\n      }\n\n      nameList.forEach((name) => {\n        const formItemRef = getMapValue(name, formMapRef);\n        if (!formItemRef) return;\n\n        const fieldValue = calcFieldValue(name, formItemRef?.current.getValue?.());\n        merge(fieldsValue, fieldValue);\n      });\n    }\n    return fieldsValue;\n  }\n\n  // 对外方法，设置对应 formItem 的值\n  function setFieldsValue(fields = {}) {\n    travelMapFromObject(fields, formMapRef, (formItemRef, fieldValue) => {\n      formItemRef?.current?.setValue?.(fieldValue, fields);\n    });\n  }\n\n  // 对外方法，设置对应 formItem 的数据\n  function setFields(fields = []) {\n    if (!Array.isArray(fields)) throw new Error('setFields 参数需要 Array 类型');\n\n    fields.forEach((field) => {\n      const { name, ...restFields } = field;\n      const formItemRef = getMapValue(name, formMapRef);\n\n      formItemRef?.current?.setField(restFields, field);\n    });\n  }\n\n  // 对外方法，重置对应 formItem 的数据\n  function reset(params: FormResetParams<FormData>) {\n    // reset all\n    if (typeof params === 'undefined') {\n      [...formMapRef.current.values()].forEach((formItemRef) => {\n        formItemRef?.current?.resetField();\n      });\n    } else {\n      const { type = 'initial', fields = [] } = params;\n\n      fields.forEach((name) => {\n        const formItemRef = getMapValue(name, formMapRef);\n        formItemRef?.current?.resetField(type);\n      });\n    }\n    onReset?.({});\n  }\n\n  // 对外方法，重置对应 formItem 的状态\n  function clearValidate(fields?: Array<keyof FormData>) {\n    // reset all\n    if (typeof fields === 'undefined') {\n      [...formMapRef.current.values()].forEach((formItemRef) => {\n        formItemRef?.current?.resetValidate();\n      });\n    } else {\n      if (!Array.isArray(fields)) throw new Error('clearValidate 参数需要 Array 类型');\n\n      fields.forEach((name) => {\n        const formItemRef = getMapValue(name, formMapRef);\n        formItemRef?.current?.resetValidate();\n      });\n    }\n  }\n\n  // 对外方法，设置 formItem 的错误信息\n  function setValidateMessage(message: FormValidateMessage<FormData>) {\n    travelMapFromObject(message, formMapRef, (formItemRef, fieldValue) => {\n      formItemRef?.current?.setValidateMessage?.(fieldValue);\n    });\n  }\n\n  return {\n    submit,\n    reset,\n    validate,\n    validateOnly,\n    clearValidate,\n    setFields,\n    setFieldsValue,\n    setValidateMessage,\n    getFieldValue,\n    getFieldsValue,\n    currentElement: formRef.current,\n    getCurrentElement: () => formRef.current,\n  };\n}\n"],"names":["needValidate","name","fields","Array","isArray","some","item","String","formatValidateResult","validateResultList","result","reduce","r","err","Object","assign","keys","forEach","key","filter","fr","includes","keyList","split","fieldValue","calcFieldValue","merge","isEmpty","useInstance","props","formRef","formMapRef","_useConfig","useConfig","classPrefix","scrollToFirstError","_props$preventSubmitD","preventSubmitDefault","onSubmit","onReset","getFirstError","_r$firstKey$","_Object$keys","_Object$keys2","_slicedToArray","firstKey","scrollTo","concat","message","selector","_formRef$current$quer","_formRef$current","dom","current","querySelector","call","behavior","scrollIntoView","submit","e","_e$preventDefault","_e$stopPropagation","preventDefault","stopPropagation","validate","then","firstError","getFieldsValue","validateResult","_callee","param","_ref","_ref$trigger","trigger","showErrorMessage","list","validateList","_regeneratorRuntime","wrap","_callee$","_context","prev","next","_toConsumableArray","values","formItemRef","_formItemRef$current13","_formItemRef$current14","isFunction","map","Promise","all","sent","abrupt","stop","_validate","apply","arguments","validateOnly","_callee2","_ref2","_ref2$trigger","_callee2$","_context2","_formItemRef$current15","_formItemRef$current16","_formItemRef$current$4","_formItemRef$current17","_validateOnly","getFieldValue","_formItemRef$current","_formItemRef$current$","getMapValue","getValue","nameList","fieldsValue","_iterator","_createForOfIteratorHelper","entries","reverse","_step","s","n","done","_formItemRef$current$2","_formItemRef$current2","_step$value","value","f","log","error","_formItemRef$current$3","_formItemRef$current3","setFieldsValue","length","undefined","travelMapFromObject","_formItemRef$current4","_formItemRef$current5","setValue","setFields","Error","field","_formItemRef$current6","restFields","_objectWithoutProperties","_excluded","setField","reset","params","_formItemRef$current7","resetField","_params$type","type","_params$fields","_formItemRef$current8","clearValidate","_formItemRef$current9","resetValidate","_formItemRef$current10","setValidateMessage","_formItemRef$current11","_formItemRef$current12","currentElement","getCurrentElement"],"mappings":"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"}