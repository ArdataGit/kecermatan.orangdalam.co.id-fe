{"version":3,"file":"useInitialData.js","sources":["../../src/form/useInitialData.ts"],"sourcesContent":["import React from 'react';\nimport get from 'lodash/get';\n\n// 兼容特殊数据结构和受控 key\nimport Tree from '../tree/Tree';\nimport Upload from '../upload/upload';\nimport CheckTag from '../tag/CheckTag';\nimport Checkbox from '../checkbox/Checkbox';\nimport TagInput from '../tag-input/TagInput';\nimport RangeInput from '../range-input/RangeInput';\nimport Transfer from '../transfer/Transfer';\nimport CheckboxGroup from '../checkbox/CheckboxGroup';\nimport DateRangePicker from '../date-picker/DateRangePicker';\nimport TimeRangePicker from '../time-picker/TimeRangePicker';\n\n// FormItem 子组件受控 key\nexport const ctrlKeyMap = new Map();\nctrlKeyMap.set(Checkbox, 'checked');\nctrlKeyMap.set(CheckTag, 'checked');\nctrlKeyMap.set(Upload, 'files');\n\n// FormItem 默认数据类型\nexport const initialDataMap = new Map();\n[Tree, Upload, Transfer, TagInput, RangeInput, CheckboxGroup, DateRangePicker, TimeRangePicker].forEach((component) => {\n  initialDataMap.set(component, []);\n});\n[Checkbox].forEach((component) => {\n  initialDataMap.set(component, false);\n});\n\n// 整理初始值 优先级：Form.initialData < FormList.initialData < FormItem.initialData\nexport function getDefaultInitialData({\n  name,\n  formListName,\n  children,\n  initialData,\n  FromContextInitialData,\n  FormListInitialData,\n}) {\n  let defaultInitialData;\n  if (FromContextInitialData) {\n    if (typeof name === 'string') defaultInitialData = get(FromContextInitialData, name);\n    if (Array.isArray(name)) {\n      const nameList = formListName ? [formListName, ...name] : name;\n      defaultInitialData = get(FromContextInitialData, nameList);\n    }\n  }\n  if (FormListInitialData.length) {\n    defaultInitialData = get(FormListInitialData, name);\n  }\n  if (typeof initialData !== 'undefined') defaultInitialData = initialData;\n  React.Children.forEach(children, (child) => {\n    if (child && React.isValidElement(child) && typeof defaultInitialData === 'undefined') {\n      // @ts-ignore\n      const isMultiple = child?.props?.multiple;\n      defaultInitialData = isMultiple ? [] : initialDataMap.get(child.type);\n    }\n  });\n  return defaultInitialData;\n}\n"],"names":["ctrlKeyMap","Map","set","Checkbox","CheckTag","Upload","initialDataMap","Tree","Transfer","TagInput","RangeInput","CheckboxGroup","DateRangePicker","TimeRangePicker","forEach","component","getDefaultInitialData","_ref","name","formListName","children","initialData","FromContextInitialData","FormListInitialData","defaultInitialData","get","Array","isArray","nameList","concat","_toConsumableArray","length","React","Children","child","isValidElement","_child$props","isMultiple","props","multiple","type"],"mappings":"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"}