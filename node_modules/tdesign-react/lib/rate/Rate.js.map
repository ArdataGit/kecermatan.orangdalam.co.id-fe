{"version":3,"file":"Rate.js","sources":["../../src/rate/Rate.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport classNames from 'classnames';\nimport { StarFilledIcon as TdStarFilledIcon } from 'tdesign-icons-react';\nimport { TooltipLite } from '../tooltip';\nimport { TdRateProps } from './type';\nimport { StyledProps } from '../common';\nimport useConfig from '../hooks/useConfig';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport useControlled from '../hooks/useControlled';\nimport { rateDefaultProps } from './defaultProps';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport interface RateProps extends TdRateProps, StyledProps {}\n\ninterface RateIconProps {\n  icon: React.ReactNode;\n  color: string;\n  size: string;\n}\n\n// 评分图标\n// fix: 2550\nconst RateIcon: React.FC<RateIconProps> = ({ icon, ...props }) => {\n  const { StarFilledIcon } = useGlobalIcon({ StarFilledIcon: TdStarFilledIcon });\n  if (React.isValidElement(icon)) {\n    return React.cloneElement(icon, props);\n  }\n  return <StarFilledIcon {...props} />;\n};\n\nconst Rate = React.forwardRef<HTMLDivElement, RateProps>((originalProps, ref) => {\n  const props = useDefaultProps<RateProps>(originalProps, rateDefaultProps);\n\n  const { allowHalf, color, count, disabled, gap, showText, size, texts, icon, className, style, onChange } = props;\n\n  const { classPrefix } = useConfig();\n  const [starValue = 0, setStarValue] = useControlled(props, 'value', onChange);\n\n  const [hoverValue = undefined, setHoverValue] = useState<number | undefined>(undefined);\n  const displayValue = hoverValue || starValue;\n\n  const rootRef = React.useRef<HTMLUListElement>(null);\n\n  const activeColor = Array.isArray(color) ? color[0] : color;\n  const defaultColor = Array.isArray(color) ? color[1] : 'var(--td-bg-color-component)';\n\n  const getStarValue = (event: React.MouseEvent<HTMLLIElement, globalThis.MouseEvent>, index: number) => {\n    if (allowHalf) {\n      const rootNode = rootRef.current;\n      const { left } = rootNode.getBoundingClientRect();\n      const firstStar = rootNode.firstChild as HTMLElement;\n      const { width } = firstStar.getBoundingClientRect();\n      const { clientX } = event;\n      const starMiddle = width * (index - 0.5) + gap * (index - 1);\n      if (clientX - left >= starMiddle) {\n        return index;\n      }\n      if (clientX - left < starMiddle) {\n        return index - 0.5;\n      }\n    }\n\n    return index;\n  };\n\n  const mouseEnterHandler = (event: React.MouseEvent<HTMLLIElement, globalThis.MouseEvent>, index: number) => {\n    if (disabled) {\n      return;\n    }\n    setHoverValue(getStarValue(event, index));\n  };\n\n  const mouseLeaveHandler = () => {\n    if (disabled) {\n      return;\n    }\n    setHoverValue(undefined);\n  };\n\n  const clickHandler = (event: React.MouseEvent<HTMLLIElement, globalThis.MouseEvent>, index: number) => {\n    if (disabled) {\n      return;\n    }\n    setStarValue(getStarValue(event, index));\n  };\n\n  const getStarCls = (index: number) => {\n    if (allowHalf && index + 0.5 === displayValue) {\n      return `${classPrefix}-rate__item--half`;\n    }\n    if (index >= displayValue) {\n      return '';\n    }\n    if (index < displayValue) {\n      return `${classPrefix}-rate__item--full`;\n    }\n  };\n\n  return (\n    <div\n      ref={ref}\n      style={style}\n      className={classNames(`${classPrefix}-rate`, className)}\n      onMouseLeave={mouseLeaveHandler}\n    >\n      <ul className={`${classPrefix}-rate__list`} style={{ gap }} ref={rootRef}>\n        {[...Array(count)].map((_, index) => (\n          <li\n            key={index}\n            className={classNames(`${classPrefix}-rate__item`, getStarCls(index))}\n            onClick={(event) => clickHandler(event, index + 1)}\n            onMouseMove={(event) => mouseEnterHandler(event, index + 1)}\n          >\n            {showText ? (\n              <TooltipLite key={index} content={texts[displayValue - 1]}>\n                <div className={`${classPrefix}-rate__star-top`}>\n                  <RateIcon size={size} color={activeColor} icon={icon} />\n                </div>\n                <div className={`${classPrefix}-rate__star-bottom`}>\n                  <RateIcon size={size} color={defaultColor} icon={icon} />\n                </div>\n              </TooltipLite>\n            ) : (\n              <>\n                <div className={`${classPrefix}-rate__star-top`}>\n                  <RateIcon size={size} color={activeColor} icon={icon} />\n                </div>\n                <div className={`${classPrefix}-rate__star-bottom`}>\n                  <RateIcon size={size} color={defaultColor} icon={icon} />\n                </div>\n              </>\n            )}\n          </li>\n        ))}\n      </ul>\n      {showText && <div className={`${classPrefix}-rate__text`}>{texts[displayValue - 1]}</div>}\n    </div>\n  );\n});\n\nRate.displayName = 'Rate';\n\nexport default Rate;\n"],"names":["RateIcon","_ref","icon","props","_useGlobalIcon","useGlobalIcon","StarFilledIcon","TdStarFilledIcon","React","isValidElement","cloneElement","createElement","_objectSpread","Rate","forwardRef","originalProps","ref","useDefaultProps","rateDefaultProps","allowHalf","color","count","disabled","gap","showText","size","texts","className","style","onChange","_useConfig","useConfig","classPrefix","_useControlled","useControlled","_useControlled2","_slicedToArray","_useControlled2$","starValue","setStarValue","_useState","useState","_useState2","_useState2$","hoverValue","setHoverValue","displayValue","rootRef","useRef","activeColor","Array","isArray","defaultColor","getStarValue","event","index","rootNode","current","_rootNode$getBounding","getBoundingClientRect","left","firstStar","firstChild","_firstStar$getBoundin","width","clientX","starMiddle","mouseEnterHandler","mouseLeaveHandler","clickHandler","getStarCls","concat","classNames","onMouseLeave","_toConsumableArray","map","_","key","onClick","onMouseMove","TooltipLite","content","Fragment","displayName"],"mappings":"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"}