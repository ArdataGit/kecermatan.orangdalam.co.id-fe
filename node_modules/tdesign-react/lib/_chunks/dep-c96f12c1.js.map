{"version":3,"file":"dep-c96f12c1.js","sources":["../../src/checkbox/CheckboxGroup.tsx","../../src/checkbox/Checkbox.tsx"],"sourcesContent":["import React, { ReactElement, useEffect, useMemo, useState } from 'react';\nimport classNames from 'classnames';\nimport isNumber from 'lodash/isNumber';\nimport useConfig from '../hooks/useConfig';\nimport { CheckContext, CheckContextValue, CheckProps } from '../common/Check';\nimport { CheckboxGroupValue, CheckboxOption, CheckboxOptionObj, TdCheckboxGroupProps, TdCheckboxProps } from './type';\nimport { StyledProps } from '../common';\nimport useControlled from '../hooks/useControlled';\nimport Checkbox from './Checkbox';\nimport { checkboxGroupDefaultProps } from './defaultProps';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport interface CheckboxGroupProps<T extends CheckboxGroupValue = CheckboxGroupValue>\n  extends TdCheckboxGroupProps<T>,\n    StyledProps {\n  children?: React.ReactNode;\n}\n\n// 将 checkBox 的 value 转换为 string|number\nconst getCheckboxValue = (v: CheckboxOption): string | number => {\n  switch (typeof v) {\n    case 'number':\n      return v as number;\n    case 'string':\n      return v as string;\n    case 'object': {\n      const vs = v as CheckboxOptionObj;\n      return vs.value;\n    }\n    default:\n      return undefined;\n  }\n};\n\n/**\n * 多选选项组，里面可以嵌套 <Checkbox />\n */\nconst CheckboxGroup = <T extends CheckboxGroupValue = CheckboxGroupValue>(props: CheckboxGroupProps<T>) => {\n  type ItemType = T[number];\n  const { classPrefix } = useConfig();\n  const {\n    onChange,\n    disabled,\n    className,\n    style,\n    children,\n    max,\n    options = [],\n  } = useDefaultProps<CheckboxGroupProps<T>>(props, checkboxGroupDefaultProps);\n\n  // 去掉所有 checkAll 之后的 options\n  const intervalOptions =\n    Array.isArray(options) && options.length > 0\n      ? options\n      : React.Children.map(children, (child) => (child as ReactElement).props) || [];\n\n  const optionsWithoutCheckAll = intervalOptions.filter((t) => typeof t !== 'object' || !t.checkAll);\n  const optionsWithoutCheckAllValues = [];\n  optionsWithoutCheckAll.forEach((v) => {\n    const vs = getCheckboxValue(v);\n    optionsWithoutCheckAllValues.push(vs);\n  });\n\n  const [internalValue, setInternalValue] = useControlled(props, 'value', onChange);\n  const [localMax, setLocalMax] = useState(max);\n\n  const checkedSet = useMemo(() => {\n    if (!Array.isArray(internalValue)) {\n      return new Set<ItemType>([]);\n    }\n    return new Set<ItemType>([].concat(internalValue));\n  }, [internalValue]);\n\n  // 用于决定全选状态的属性\n  const indeterminate = useMemo(() => {\n    const list = Array.from(checkedSet);\n    return list.length !== 0 && list.length !== optionsWithoutCheckAll.length;\n  }, [checkedSet, optionsWithoutCheckAll]);\n\n  const checkAllChecked = useMemo(() => {\n    const list = Array.from(checkedSet);\n    return list.length === optionsWithoutCheckAll.length;\n  }, [checkedSet, optionsWithoutCheckAll]);\n\n  useEffect(() => {\n    if (!isNumber(max)) {\n      return;\n    }\n    if (max < checkedSet.size) {\n      console.warn('[TDesign] max should be less than the length of value, change is invalid');\n    } else {\n      setLocalMax(max);\n    }\n  }, [max, checkedSet]);\n\n  const context: CheckContextValue = {\n    inject: (\n      checkProps: CheckProps & {\n        // check 组件不关心 value 的类型，只关心是否存在，所以为了兼容 checkbox group 的类型\n        // 此处覆盖 checkbox 默认 value 的类型，使用 checkbox group 的 generic type 代替\n        value: ItemType;\n      },\n    ) => {\n      // 如果已经受控，则不注入\n      if (typeof checkProps.checked !== 'undefined') {\n        return checkProps;\n      }\n\n      const { value: checkValue } = checkProps;\n\n      return {\n        ...checkProps,\n        checked: checkProps.checkAll ? checkAllChecked : checkedSet.has(checkValue),\n        indeterminate: checkProps.checkAll ? indeterminate : checkProps.indeterminate,\n        disabled: checkProps.disabled || disabled || (checkedSet.size >= localMax && !checkedSet.has(checkValue)),\n        onChange(checked, { e }) {\n          if (typeof checkProps.onChange === 'function') {\n            checkProps.onChange(checked, { e });\n          }\n\n          // 全选时的逻辑处理\n          if (checkProps.checkAll) {\n            checkedSet.clear();\n            if (checked) {\n              optionsWithoutCheckAllValues.forEach((v) => {\n                checkedSet.add(v);\n              });\n            }\n          } else if (checked) {\n            if (checkedSet.size >= localMax && isNumber(max)) return;\n            checkedSet.add(checkValue);\n          } else {\n            checkedSet.delete(checkValue);\n          }\n\n          // 此处 `as` 是因为 `Array.from` 会导致 `checkSet` 的 generic type 丢失\n          setInternalValue(Array.from(checkedSet) as T, {\n            e,\n            current: checkProps.checkAll ? undefined : (checkValue as TdCheckboxProps),\n            type: checked ? 'check' : 'uncheck',\n          });\n        },\n      };\n    },\n  };\n\n  // options 和 children 的抉择,在未明确说明时，暂时以 options 优先\n  const useOptions = Array.isArray(options) && options.length !== 0;\n\n  return (\n    <div className={classNames(`${classPrefix}-checkbox-group`, className)} style={style}>\n      <CheckContext.Provider value={context}>\n        {useOptions\n          ? options.map((v: any, index) => {\n              const type = typeof v;\n              switch (type) {\n                case 'string': {\n                  const vs = v as string;\n                  return (\n                    <Checkbox key={index} label={vs} value={vs}>\n                      {v}\n                    </Checkbox>\n                  );\n                }\n                case 'number': {\n                  const vs = v as number;\n                  return (\n                    <Checkbox key={index} label={vs} value={vs}>\n                      {v}\n                    </Checkbox>\n                  );\n                }\n                case 'object': {\n                  const vs = v as CheckboxOptionObj;\n                  // CheckAll 的 checkBox 不存在 value,故用 checkAll_index 来保证尽量不和用户的 value 冲突.\n                  return vs.checkAll ? (\n                    <Checkbox {...vs} key={`checkAll_${index}`} indeterminate={indeterminate} />\n                  ) : (\n                    <Checkbox {...vs} key={index} disabled={vs.disabled || disabled} />\n                  );\n                }\n                default:\n                  return null;\n              }\n            })\n          : children}\n      </CheckContext.Provider>\n    </div>\n  );\n};\n\nCheckboxGroup.displayName = 'CheckboxGroup';\n\nexport default CheckboxGroup;\n","import React from 'react';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport Check, { CheckProps } from '../common/Check';\nimport CheckboxGroup from './CheckboxGroup';\nimport { checkboxDefaultProps } from './defaultProps';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport type CheckboxProps = Omit<CheckProps, 'type'>;\n\nconst Checkbox = forwardRefWithStatics(\n  (props: CheckboxProps, ref: React.Ref<HTMLLabelElement>) => (\n    <Check ref={ref} type=\"checkbox\" {...useDefaultProps<CheckboxProps>(props, checkboxDefaultProps)} />\n  ),\n  { Group: CheckboxGroup },\n);\n\nCheckbox.displayName = 'Checkbox';\n\nexport default Checkbox;\n"],"names":["getCheckboxValue","v","_typeof","vs","value","CheckboxGroup","props","_useConfig","useConfig","classPrefix","_useDefaultProps","useDefaultProps","checkboxGroupDefaultProps","onChange","disabled","className","style","children","max","_useDefaultProps$opti","options","intervalOptions","Array","isArray","length","React","Children","map","child","optionsWithoutCheckAll","filter","t","checkAll","optionsWithoutCheckAllValues","forEach","push","_useControlled","useControlled","_useControlled2","_slicedToArray","internalValue","setInternalValue","_useState","useState","_useState2","localMax","setLocalMax","checkedSet","useMemo","Set","concat","indeterminate","list","from","checkAllChecked","useEffect","isNumber","size","console","warn","context","inject","checkProps","checked","checkValue","_objectSpread","has","_ref","e","clear","add","current","type","useOptions","createElement","classNames","CheckContext","Provider","index","Checkbox","key","label","displayName","forwardRefWithStatics","ref","Check","checkboxDefaultProps","Group"],"mappings":"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"}