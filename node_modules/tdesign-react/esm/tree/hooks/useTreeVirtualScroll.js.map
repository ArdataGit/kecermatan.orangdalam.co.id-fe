{"version":3,"file":"useTreeVirtualScroll.js","sources":["../../../src/tree/hooks/useTreeVirtualScroll.ts"],"sourcesContent":["import { useMemo, useEffect, CSSProperties } from 'react';\nimport useVirtualScroll from '../../hooks/useVirtualScroll';\nimport TreeNode from '../../_common/js/tree-v1/tree-node';\nimport { TScroll } from '../../common';\n\nexport default function useTreeVirtualScroll({\n  treeRef,\n  scroll,\n  data = [],\n}: {\n  data: TreeNode[];\n  scroll: TScroll;\n  treeRef: React.MutableRefObject<HTMLElement>;\n}) {\n  const scrollThreshold = scroll?.threshold || 100;\n  const scrollType = scroll?.type;\n\n  const isVirtual = useMemo(\n    () => scrollType === 'virtual' && data?.length > scrollThreshold,\n    [scrollType, scrollThreshold, data],\n  );\n\n  const scrollParams = useMemo(\n    () =>\n      ({\n        type: 'virtual',\n        isFixedRowHeight: scroll?.isFixedRowHeight || false, // expand and collapse operation make height of tree item different\n        rowHeight: scroll?.rowHeight || 34,\n        bufferSize: scroll?.bufferSize || 20,\n        threshold: scrollThreshold,\n      } as const),\n    [scroll, scrollThreshold],\n  );\n\n  const {\n    visibleData = null,\n    handleScroll: handleVirtualScroll = null,\n    scrollHeight = null,\n    translateY = null,\n    handleRowMounted = null,\n    scrollToElement,\n  } = useVirtualScroll(treeRef, {\n    data: data || [],\n    scroll: scrollParams,\n  });\n\n  let lastScrollY = -1;\n  const onInnerVirtualScroll = (e: WheelEvent) => {\n    if (!isVirtual) {\n      return;\n    }\n    const target = e.target as HTMLElement;\n    const top = target.scrollTop;\n    if (lastScrollY !== top) {\n      handleVirtualScroll();\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    } else {\n      lastScrollY = -1;\n    }\n    lastScrollY = top;\n  };\n\n  useEffect(() => {\n    const treeList = treeRef?.current;\n    if (isVirtual) {\n      treeList?.addEventListener?.('scroll', onInnerVirtualScroll);\n    }\n    return () => {\n      // 卸载时取消监听\n      if (isVirtual) {\n        treeList?.removeEventListener?.('scroll', onInnerVirtualScroll);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isVirtual, onInnerVirtualScroll]);\n\n  const cursorStyle = {\n    position: 'absolute',\n    width: '1px',\n    height: '1px',\n    transition: 'transform 0.2s',\n    transform: `translate(0, ${scrollHeight}px)`,\n    MsTransform: `translate(0, ${scrollHeight}px)`,\n    MozTransform: `translate(0, ${scrollHeight}px)`,\n    WebkitTransform: `translate(0, ${scrollHeight}px)`,\n  } as CSSProperties;\n\n  const treeNodeStyle = {\n    transform: `translate(0, ${translateY}px)`,\n    MsTransform: `translate(0, ${translateY}px)`,\n    MozTransform: `translate(0, ${translateY}px)`,\n    WebkitTransform: `translate(0, ${translateY}px)`,\n  } as CSSProperties;\n\n  return {\n    scrollHeight,\n    translateY,\n    visibleData,\n    handleRowMounted,\n    isVirtual,\n    cursorStyle,\n    treeNodeStyle,\n    scrollToElement,\n  };\n}\n"],"names":["useTreeVirtualScroll","_ref","treeRef","scroll","_ref$data","data","scrollThreshold","threshold","scrollType","type","isVirtual","useMemo","length","scrollParams","isFixedRowHeight","rowHeight","bufferSize","_useVirtualScroll","useVirtualScroll","_useVirtualScroll$vis","visibleData","_useVirtualScroll$han","handleScroll","handleVirtualScroll","_useVirtualScroll$scr","scrollHeight","_useVirtualScroll$tra","translateY","_useVirtualScroll$han2","handleRowMounted","scrollToElement","lastScrollY","onInnerVirtualScroll","e","target","top","scrollTop","useEffect","treeList","current","_treeList$addEventLis","addEventListener","call","_treeList$removeEvent","removeEventListener","cursorStyle","position","width","height","transition","transform","MsTransform","MozTransform","WebkitTransform","treeNodeStyle"],"mappings":"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"}