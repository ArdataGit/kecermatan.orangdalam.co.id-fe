{"version":3,"file":"useFixed.js","sources":["../../../src/table/hooks/useFixed.ts"],"sourcesContent":["import { useEffect, useState, useMemo, useRef, WheelEvent } from 'react';\nimport get from 'lodash/get';\nimport pick from 'lodash/pick';\nimport xorWith from 'lodash/xorWith';\nimport { getIEVersion } from '../../_common/js/utils/helper';\nimport log from '../../_common/js/log';\nimport { ClassName, Styles } from '../../common';\nimport { BaseTableCol, TableRowData, TdBaseTableProps } from '../type';\nimport { getScrollbarWidthWithCSS } from '../../_common/js/utils/getScrollbarWidth';\nimport { on, off } from '../../_util/dom';\nimport { FixedColumnInfo, TableRowFixedClasses, RowAndColFixedPosition, TableColFixedClasses } from '../interface';\nimport useDebounce from '../../hooks/useDebounce';\nimport usePrevious from '../../hooks/usePrevious';\n\n// 固定列相关类名处理\nexport function getColumnFixedStyles(\n  col: TdBaseTableProps['columns'][0],\n  index: number,\n  rowAndColFixedPosition: RowAndColFixedPosition,\n  tableColFixedClasses: TableColFixedClasses,\n): { style?: Styles; classes?: ClassName } {\n  const fixedPos = rowAndColFixedPosition?.get(col.colKey || index);\n  if (!fixedPos) return {};\n  const thClasses = {\n    [tableColFixedClasses.left]: col.fixed === 'left',\n    [tableColFixedClasses.right]: col.fixed === 'right',\n    [tableColFixedClasses.lastLeft]: col.fixed === 'left' && fixedPos.lastLeftFixedCol,\n    [tableColFixedClasses.firstRight]: col.fixed === 'right' && fixedPos.firstRightFixedCol,\n  };\n  const thStyles = {\n    left: col.fixed === 'left' ? `${fixedPos.left}px` : undefined,\n    right: col.fixed === 'right' ? `${fixedPos.right}px` : undefined,\n  };\n  return {\n    style: thStyles,\n    classes: thClasses,\n  };\n}\n\n// 固定行相关类名处理\nexport function getRowFixedStyles(\n  rowId: string | number,\n  rowIndex: number,\n  rowLength: number,\n  fixedRows: TdBaseTableProps['fixedRows'],\n  rowAndColFixedPosition: RowAndColFixedPosition,\n  tableRowFixedClasses: TableRowFixedClasses,\n): { style: Styles; classes: ClassName } {\n  if (!fixedRows || !fixedRows.length) return { style: undefined, classes: undefined };\n  const fixedTop = rowIndex < fixedRows[0];\n  const fixedBottom = rowIndex > rowLength - 1 - fixedRows[1];\n  const firstFixedBottomRow = rowLength - fixedRows[1];\n  const fixedPos = rowAndColFixedPosition?.get(rowId) || {};\n  const rowClasses = {\n    [tableRowFixedClasses.top]: fixedTop,\n    [tableRowFixedClasses.bottom]: fixedBottom,\n    [tableRowFixedClasses.firstBottom]: rowIndex === firstFixedBottomRow,\n    [tableRowFixedClasses.withoutBorderBottom]: rowIndex === firstFixedBottomRow - 1,\n  };\n  const rowStyles = {\n    top: fixedTop ? `${fixedPos.top}px` : undefined,\n    bottom: fixedBottom ? `${fixedPos.bottom}px` : undefined,\n  };\n  return {\n    style: rowStyles,\n    classes: rowClasses,\n  };\n}\n\nexport default function useFixed(\n  props: TdBaseTableProps,\n  finalColumns: BaseTableCol<TableRowData>[],\n  // affixRef?: {\n  //   paginationAffixRef: MutableRefObject<HTMLDivElement>;\n  //   horizontalScrollAffixRef: MutableRefObject<HTMLDivElement>;\n  //   headerTopAffixRef: MutableRefObject<HTMLDivElement>;\n  //   footerBottomAffixRef: MutableRefObject<HTMLDivElement>;\n  // },\n) {\n  const {\n    columns,\n    tableLayout,\n    tableContentWidth,\n    fixedRows,\n    firstFullRow,\n    lastFullRow,\n    maxHeight,\n    headerAffixedTop,\n    bordered,\n  } = props;\n  const preFinalColumns = usePrevious(finalColumns);\n  const [data, setData] = useState<TableRowData[]>([]);\n  const tableContentRef = useRef<HTMLDivElement>();\n  const [isFixedHeader, setIsFixedHeader] = useState(false);\n  const [isWidthOverflow, setIsWidthOverflow] = useState(false);\n  const tableElmRef = useRef<HTMLTableElement>();\n  // CSS 样式设置了固定 6px\n  const [scrollbarWidth, setScrollbarWidth] = useState(6);\n  // 固定列、固定表头、固定表尾等内容的位置信息\n  const [rowAndColFixedPosition, setRowAndColFixedPosition] = useState<RowAndColFixedPosition>(new Map());\n  const [showColumnShadow, setShowColumnShadow] = useState({\n    left: false,\n    right: false,\n  });\n  // 虚拟滚动无法使用 CSS sticky 固定表头\n  const [virtualScrollHeaderPos, setVirtualScrollHeaderPos] = useState<{ left: number; top: number }>({\n    left: 0,\n    top: 0,\n  });\n  const tableWidth = useRef(0);\n  const tableElmWidth = useRef(0);\n  const thWidthList = useRef<{ [colKey: string]: number }>({});\n\n  const [isFixedColumn, setIsFixedColumn] = useState(false);\n  const [isFixedRightColumn, setIsFixedRightColumn] = useState(false);\n  const [isFixedLeftColumn, setIsFixedLeftColumn] = useState(false);\n\n  const columnResizable = props.resizable;\n\n  // 没有表头吸顶，没有虚拟滚动，则不需要表头宽度计算\n  const notNeedThWidthList = useMemo(\n    () =>\n      !(\n        props.headerAffixedTop ||\n        props.footerAffixedBottom ||\n        props.horizontalScrollAffixedBottom ||\n        props.scroll?.type === 'virtual'\n      ),\n    [props.footerAffixedBottom, props.headerAffixedTop, props.horizontalScrollAffixedBottom, props.scroll?.type],\n  );\n\n  function setUseFixedTableElmRef(val: HTMLTableElement) {\n    tableElmRef.current = val;\n  }\n\n  function getColumnMap(\n    columns: BaseTableCol[],\n    map: RowAndColFixedPosition = new Map(),\n    levelNodes: FixedColumnInfo[][] = [],\n    level = 0,\n    parent?: FixedColumnInfo,\n  ) {\n    for (let i = 0, len = columns.length; i < len; i++) {\n      const col = columns[i];\n      if (['left', 'right'].includes(col.fixed)) {\n        setIsFixedColumn(true);\n      }\n      if (col.fixed === 'right') {\n        setIsFixedRightColumn(true);\n      }\n      if (col.fixed === 'left') {\n        setIsFixedLeftColumn(true);\n      }\n      const key = col.colKey || i;\n      const columnInfo: FixedColumnInfo = { col, parent, index: i };\n      map.set(key, columnInfo);\n      if (col.children?.length) {\n        getColumnMap(col.children, map, levelNodes, level + 1, columnInfo);\n      }\n      if (levelNodes[level]) {\n        levelNodes[level].push(columnInfo);\n      } else {\n        // eslint-disable-next-line no-param-reassign\n        levelNodes[level] = [columnInfo];\n      }\n    }\n    return {\n      newColumnsMap: map,\n      levelNodes,\n    };\n  }\n\n  const setFixedLeftPos = (\n    columns: BaseTableCol[],\n    initialColumnMap: RowAndColFixedPosition,\n    parent: FixedColumnInfo = {},\n  ) => {\n    for (let i = 0, len = columns.length; i < len; i++) {\n      const col = columns[i];\n      if (col.fixed === 'right') return;\n      const colInfo = initialColumnMap.get(col.colKey || i);\n      let lastColIndex = i - 1;\n      while (lastColIndex >= 0 && columns[lastColIndex].fixed !== 'left') {\n        lastColIndex -= 1;\n      }\n      const lastCol = columns[lastColIndex];\n      // 多级表头，使用父元素作为初始基本位置\n      const defaultWidth = i === 0 ? parent?.left || 0 : 0;\n      const lastColInfo = initialColumnMap.get(lastCol?.colKey || i - 1);\n      colInfo.left = (lastColInfo?.left || defaultWidth) + (lastColInfo?.width || 0);\n      // 多级表头\n      if (col.children?.length) {\n        setFixedLeftPos(col.children, initialColumnMap, colInfo);\n      }\n    }\n  };\n\n  const setFixedRightPos = (\n    columns: BaseTableCol[],\n    initialColumnMap: RowAndColFixedPosition,\n    parent: FixedColumnInfo = {},\n  ) => {\n    for (let i = columns.length - 1; i >= 0; i--) {\n      const col = columns[i];\n      if (col.fixed === 'left') return;\n      const colInfo = initialColumnMap.get(col.colKey || i);\n      let lastColIndex = i + 1;\n      while (lastColIndex < columns.length && columns[lastColIndex].fixed !== 'right') {\n        lastColIndex += 1;\n      }\n      const lastCol = columns[lastColIndex];\n      // 多级表头，使用父元素作为初始基本位置\n      const defaultWidth = i === columns.length - 1 ? parent?.right || 0 : 0;\n      const lastColInfo = initialColumnMap.get(lastCol?.colKey || i + 1);\n      colInfo.right = (lastColInfo?.right || defaultWidth) + (lastColInfo?.width || 0);\n      // 多级表头\n      if (col.children?.length) {\n        setFixedRightPos(col.children, initialColumnMap, colInfo);\n      }\n    }\n  };\n\n  // 获取固定列位置信息。先获取节点宽度，再计算\n  const setFixedColPosition = (trList: HTMLCollection, initialColumnMap: RowAndColFixedPosition) => {\n    if (!trList) return;\n    for (let i = 0, len = trList.length; i < len; i++) {\n      const thList = trList[i].children;\n      for (let j = 0, thLen = thList.length; j < thLen; j++) {\n        const th = thList[j] as HTMLElement;\n        const colKey = th.dataset.colkey;\n        if (!colKey) {\n          log.warn('TDesign Table', `${th.innerText} missing colKey. colKey is required for fixed column feature.`);\n        }\n        const obj = initialColumnMap.get(colKey || j);\n        if (obj?.col?.fixed) {\n          initialColumnMap.set(colKey, { ...obj, width: th?.getBoundingClientRect?.().width });\n        }\n      }\n    }\n    setFixedLeftPos(columns, initialColumnMap);\n    setFixedRightPos(columns, initialColumnMap);\n  };\n\n  // 设置固定行位置信息 top/bottom\n  const setFixedRowPosition = (\n    trList: HTMLCollection,\n    initialColumnMap: RowAndColFixedPosition,\n    thead: HTMLTableSectionElement,\n    tfoot: HTMLTableSectionElement,\n  ) => {\n    const [fixedTopRows, fixedBottomRows] = fixedRows || [];\n    const { data, rowKey = 'id' } = props;\n    for (let i = 0; i < fixedTopRows; i++) {\n      const tr = trList[i] as HTMLElement;\n      const rowId = get(data[i], rowKey);\n      const thisRowInfo = initialColumnMap.get(rowId) || {};\n      const lastRowId = get(data[i - 1], rowKey);\n      const lastRowInfo = initialColumnMap.get(lastRowId) || {};\n      let defaultBottom = 0;\n      if (i === 0) {\n        defaultBottom = thead?.getBoundingClientRect?.().height || 0;\n      }\n      thisRowInfo.top = (lastRowInfo.top || defaultBottom) + (lastRowInfo.height || 0);\n      initialColumnMap.set(rowId, { ...thisRowInfo, height: tr?.getBoundingClientRect?.().height });\n    }\n    for (let i = data.length - 1; i >= data.length - fixedBottomRows; i--) {\n      const tr = trList[i] as HTMLElement;\n      const rowId = get(data[i], rowKey);\n      const thisRowInfo = initialColumnMap.get(rowId) || {};\n      const lastRowId = get(data[i + 1], rowKey);\n      const lastRowInfo = initialColumnMap.get(lastRowId) || {};\n      let defaultBottom = 0;\n      if (i === data.length - 1) {\n        defaultBottom = tfoot?.getBoundingClientRect?.().height || 0;\n      }\n      thisRowInfo.bottom = (lastRowInfo.bottom || defaultBottom) + (lastRowInfo.height || 0);\n      initialColumnMap.set(rowId, { ...thisRowInfo, height: tr?.getBoundingClientRect?.().height });\n    }\n  };\n\n  const updateRowAndColFixedPosition = (tableContentElm: HTMLElement, initialColumnMap: RowAndColFixedPosition) => {\n    rowAndColFixedPosition.clear();\n    if (!tableContentElm) return;\n    const thead = tableContentElm.querySelector('thead');\n    // 处理固定列\n    thead && setFixedColPosition(thead.children, initialColumnMap);\n    // 处理冻结行\n    const tbody = tableContentElm.querySelector('tbody');\n    const tfoot = tableContentElm.querySelector('tfoot');\n    tbody && setFixedRowPosition(tbody.children, initialColumnMap, thead, tfoot);\n    // 更新最终 Map\n    setRowAndColFixedPosition(initialColumnMap);\n  };\n\n  let shadowLastScrollLeft: number;\n  const updateColumnFixedShadow = (target: HTMLElement, extra?: { skipScrollLimit?: boolean }) => {\n    if (!isFixedColumn || !target) return;\n    const { scrollLeft } = target;\n    // 只有左右滚动，需要更新固定列阴影\n    if (shadowLastScrollLeft === scrollLeft && (!extra || !extra.skipScrollLimit)) return;\n    shadowLastScrollLeft = scrollLeft;\n    const isShowRight = target.clientWidth + scrollLeft < target.scrollWidth;\n    const isShowLeft = scrollLeft > 0;\n    if (showColumnShadow.left === isShowLeft && showColumnShadow.right === isShowRight) return;\n    setShowColumnShadow({\n      left: isShowLeft && isFixedLeftColumn,\n      right: isShowRight && isFixedRightColumn,\n    });\n  };\n\n  // 多级表头场景较为复杂：为了滚动的阴影效果，需要知道哪些列是边界列，左侧固定列的最后一列，右侧固定列的第一列，每一层表头都需要兼顾\n  const setIsLastOrFirstFixedCol = (levelNodes: FixedColumnInfo[][]) => {\n    for (let t = 0; t < levelNodes.length; t++) {\n      const nodes = levelNodes[t];\n      for (let i = 0, len = nodes.length; i < len; i++) {\n        const colMapInfo = nodes[i];\n        const nextColMapInfo = nodes[i + 1];\n        const { parent } = colMapInfo;\n        const isParentLastLeftFixedCol = !parent || parent?.lastLeftFixedCol;\n        if (isParentLastLeftFixedCol && colMapInfo.col.fixed === 'left' && nextColMapInfo?.col.fixed !== 'left') {\n          colMapInfo.lastLeftFixedCol = true;\n        }\n        const lastColMapInfo = nodes[i - 1];\n        const isParentFirstRightFixedCol = !parent || parent?.firstRightFixedCol;\n        if (isParentFirstRightFixedCol && colMapInfo.col.fixed === 'right' && lastColMapInfo?.col.fixed !== 'right') {\n          colMapInfo.firstRightFixedCol = true;\n        }\n      }\n    }\n  };\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const updateFixedStatus = () => {\n    const { newColumnsMap, levelNodes } = getColumnMap(columns);\n    setIsLastOrFirstFixedCol(levelNodes);\n    const timer = setTimeout(() => {\n      if (isFixedColumn || fixedRows?.length) {\n        updateRowAndColFixedPosition(tableContentRef.current, newColumnsMap);\n      }\n      clearTimeout(timer);\n    }, 0);\n    return () => {\n      clearTimeout(timer);\n    };\n  };\n\n  const updateFixedHeader = () => {\n    const tRef = tableContentRef?.current;\n    if (!tRef) return;\n    const isHeightOverflow = tRef.scrollHeight > tRef.clientHeight;\n    setIsFixedHeader(isHeightOverflow);\n    setIsWidthOverflow(tRef.scrollWidth > tRef.clientWidth);\n    const pos = tRef?.getBoundingClientRect?.();\n    setVirtualScrollHeaderPos({\n      top: pos?.top,\n      left: pos?.left,\n    });\n\n    // updateTableWidth(isHeightOverflow);\n    // updateThWidthListHandler();\n  };\n\n  const setTableElmWidth = (width: number) => {\n    if (tableElmWidth.current === width) return;\n    tableElmWidth.current = width;\n  };\n\n  const updateTableWidth = () => {\n    const rect = tableContentRef.current?.getBoundingClientRect?.();\n    if (!rect) return;\n    // 存在纵向滚动条，且固定表头时，需去除滚动条宽度\n    const reduceWidth = isFixedHeader ? scrollbarWidth : 0;\n    tableWidth.current = rect.width - reduceWidth - (props.bordered ? 1 : 0);\n    const elmRect = tableElmRef?.current?.getBoundingClientRect();\n    if (elmRect?.width) {\n      setTableElmWidth(elmRect?.width);\n    }\n  };\n\n  // 在表格高度变化的时候 需要手动调整affix的位置 因为affix本身无法监听到这些变化触发重新计算\n  const updateAffixPosition = () => {\n    // TODO: 待 affix 组件支持滚动方法\n    // affixRef.paginationAffixRef.current?.handleScroll?.();\n    // affixRef.horizontalScrollAffixRef.current?.handleScroll?.();\n    // affixRef.headerTopAffixRef.current?.handleScroll?.();\n    // affixRef.footerBottomAffixRef.current?.handleScroll?.();\n  };\n\n  const calculateThWidthList = (trList: HTMLCollection) => {\n    const widthMap: { [colKey: string]: number } = {};\n    for (let i = 0, len = trList.length; i < len; i++) {\n      const thList = trList[i].children;\n      // second for used for multiple row header\n      for (let j = 0, thLen = thList.length; j < thLen; j++) {\n        const th = thList[j] as HTMLElement;\n        const colKey = th.dataset.colkey;\n        widthMap[colKey] = th.getBoundingClientRect().width;\n      }\n    }\n    return widthMap;\n  };\n\n  const updateThWidthList = (trList: HTMLCollection | { [colKey: string]: number }) => {\n    if (trList instanceof HTMLCollection) {\n      if (columnResizable) return;\n      thWidthList.current = calculateThWidthList(trList);\n    } else {\n      thWidthList.current = thWidthList.current || {};\n      Object.entries(trList).forEach(([colKey, width]) => {\n        thWidthList.current[colKey] = width;\n      });\n    }\n    return thWidthList.current;\n  };\n\n  const updateThWidthListHandler = () => {\n    const timer = setTimeout(() => {\n      updateTableWidth();\n      if (notNeedThWidthList) return;\n      const thead = tableContentRef.current?.querySelector('thead');\n      if (!thead) return;\n      updateThWidthList(thead.children);\n      clearTimeout(timer);\n    }, 0);\n  };\n\n  const emitScrollEvent = (e: WheelEvent<HTMLDivElement>) => {\n    props.onScrollX?.({ e });\n    props.onScrollY?.({ e });\n    props.onScroll?.({ e });\n  };\n\n  const getThWidthList = (type?: 'default' | 'calculate') => {\n    if (type === 'calculate') {\n      const trList = tableContentRef.current?.querySelector('thead')?.children;\n      return calculateThWidthList(trList);\n    }\n    return thWidthList.current || {};\n  };\n\n  const updateTableElmWidthOnColumnChange = (\n    finalColumns: BaseTableCol<TableRowData>[] = [],\n    preFinalColumns: BaseTableCol<TableRowData>[] = [],\n  ) => {\n    const finalColKeys = finalColumns.map((t) => t.colKey);\n    const preColKeys = preFinalColumns.map((t) => t.colKey);\n    if (finalColKeys.length < preColKeys.length) {\n      const reduceKeys = xorWith(preColKeys, finalColKeys);\n      const thWidthList = getThWidthList('calculate');\n      let reduceWidth = 0;\n      reduceKeys.forEach((key) => {\n        reduceWidth += thWidthList[key];\n      });\n      const rootThWidthList = pick(thWidthList, preColKeys);\n      if (!Object.values(rootThWidthList).length) return;\n      const oldTotalWidth = Object.values(rootThWidthList).reduce((r = 0, n) => r + n);\n      // 保留原有可能编辑过的列宽度，但是当剩余列过小时，表头小于内容宽，需要缩放回内容宽度\n      // 使用不包含滚动条的可视化区域宽度，意味着当不再溢出的时候，将宽度设置回完整宽度\n      const contentWidth = tableContentRef.current.clientWidth;\n      const widthToReserve = oldTotalWidth - reduceWidth;\n      setTableElmWidth(Math.max(contentWidth, widthToReserve));\n    }\n  };\n\n  useEffect(\n    updateFixedStatus,\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [\n      data,\n      columns,\n      bordered,\n      tableLayout,\n      tableContentWidth,\n      isFixedHeader,\n      isWidthOverflow,\n      isFixedColumn,\n      fixedRows,\n      firstFullRow,\n      lastFullRow,\n      tableContentRef,\n    ],\n  );\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      if (isFixedColumn) {\n        updateColumnFixedShadow(tableContentRef.current);\n      }\n      clearTimeout(timer);\n    }, 0);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isFixedColumn, columns, tableContentRef]);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(updateFixedHeader, [maxHeight, data, columns, bordered, tableContentRef]);\n\n  useEffect(() => {\n    updateTableElmWidthOnColumnChange(finalColumns, preFinalColumns);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [finalColumns]);\n\n  // 影响表头宽度的元素\n  useEffect(\n    () => {\n      const timer = setTimeout(() => {\n        // updateTableWidth(isFixedHeader);\n        updateThWidthListHandler();\n        updateAffixPosition();\n        clearTimeout(timer);\n      }, 10);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [\n      // data,\n      bordered,\n      tableLayout,\n      fixedRows,\n      headerAffixedTop,\n      tableContentWidth,\n      notNeedThWidthList,\n      tableContentRef,\n    ],\n  );\n\n  const refreshTable = () => {\n    updateThWidthListHandler();\n    updateFixedHeader();\n    updateAffixPosition();\n\n    if (isFixedColumn || isFixedHeader) {\n      updateFixedStatus();\n      updateColumnFixedShadow(tableContentRef.current, { skipScrollLimit: true });\n    }\n  };\n\n  const onResize = useDebounce(() => {\n    refreshTable();\n  }, 30);\n\n  function addTableResizeObserver(tableElement: HTMLDivElement) {\n    // IE 11 以下使用 window resize；IE 11 以上使用 ResizeObserver\n    if (typeof window === 'undefined') return;\n    if (getIEVersion() < 11 || typeof window.ResizeObserver === 'undefined') return;\n    off(window, 'resize', onResize);\n    if (!tableElmWidth.current) return;\n    const resizeObserver = new window.ResizeObserver(() => {\n      const timer = setTimeout(() => {\n        refreshTable();\n        clearTimeout(timer);\n      }, 60);\n    });\n    resizeObserver.observe(tableElement);\n    return () => {\n      resizeObserver?.unobserve?.(tableElement);\n      resizeObserver?.disconnect?.();\n    };\n  }\n\n  useEffect(() => {\n    const scrollWidth = getScrollbarWidthWithCSS();\n    setScrollbarWidth(scrollWidth);\n\n    const isWatchResize = isFixedColumn || isFixedHeader || !notNeedThWidthList || !data.length;\n    const hasWindow = typeof window !== 'undefined';\n    const hasResizeObserver = hasWindow && typeof window.ResizeObserver !== 'undefined';\n    updateTableWidth();\n    updateThWidthListHandler();\n    // IE 11 以下使用 window resize；IE 11 以上使用 ResizeObserver\n    if ((isWatchResize && getIEVersion() < 11) || !hasResizeObserver) {\n      on(window, 'resize', onResize);\n    }\n\n    return () => {\n      if ((isWatchResize && getIEVersion() < 11) || !hasResizeObserver) {\n        if (typeof window !== 'undefined') {\n          off(window, 'resize', onResize);\n        }\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isFixedColumn]);\n\n  const updateTableAfterColumnResize = () => {\n    updateFixedStatus();\n    updateFixedHeader();\n  };\n\n  return {\n    tableWidth,\n    tableElmWidth,\n    thWidthList,\n    isFixedHeader,\n    isWidthOverflow,\n    tableContentRef,\n    isFixedColumn,\n    showColumnShadow,\n    rowAndColFixedPosition,\n    virtualScrollHeaderPos,\n    scrollbarWidth,\n    setData,\n    refreshTable,\n    setTableElmWidth,\n    emitScrollEvent,\n    updateThWidthListHandler,\n    updateColumnFixedShadow,\n    setUseFixedTableElmRef,\n    getThWidthList,\n    updateThWidthList,\n    addTableResizeObserver,\n    updateTableAfterColumnResize,\n  };\n}\n"],"names":["getColumnFixedStyles","col","index","rowAndColFixedPosition","tableColFixedClasses","fixedPos","get","colKey","thClasses","_defineProperty","left","fixed","right","lastLeft","lastLeftFixedCol","firstRight","firstRightFixedCol","thStyles","concat","style","classes","getRowFixedStyles","rowId","rowIndex","rowLength","fixedRows","tableRowFixedClasses","length","fixedTop","fixedBottom","firstFixedBottomRow","rowClasses","top","bottom","firstBottom","withoutBorderBottom","rowStyles","useFixed","props","finalColumns","_props$scroll2","columns","tableLayout","tableContentWidth","firstFullRow","lastFullRow","maxHeight","headerAffixedTop","bordered","preFinalColumns","usePrevious","_useState","useState","_useState2","_slicedToArray","data","setData","tableContentRef","useRef","_useState3","_useState4","isFixedHeader","setIsFixedHeader","_useState5","_useState6","isWidthOverflow","setIsWidthOverflow","tableElmRef","_useState7","_useState8","scrollbarWidth","setScrollbarWidth","_useState9","Map","_useState10","setRowAndColFixedPosition","_useState11","_useState12","showColumnShadow","setShowColumnShadow","_useState13","_useState14","virtualScrollHeaderPos","setVirtualScrollHeaderPos","tableWidth","tableElmWidth","thWidthList","_useState15","_useState16","isFixedColumn","setIsFixedColumn","_useState17","_useState18","isFixedRightColumn","setIsFixedRightColumn","_useState19","_useState20","isFixedLeftColumn","setIsFixedLeftColumn","columnResizable","resizable","notNeedThWidthList","useMemo","_props$scroll","footerAffixedBottom","horizontalScrollAffixedBottom","scroll","type","setUseFixedTableElmRef","val","current","getColumnMap","map","arguments","undefined","levelNodes","level","parent","i","len","_col$children","includes","key","columnInfo","set","children","push","newColumnsMap","setFixedLeftPos","initialColumnMap","_col$children2","colInfo","lastColIndex","lastCol","defaultWidth","lastColInfo","width","setFixedRightPos","_col$children3","setFixedColPosition","trList","thList","j","thLen","_obj$col","th","dataset","colkey","log","warn","innerText","obj","_th$getBoundingClient","_objectSpread","getBoundingClientRect","call","setFixedRowPosition","thead","tfoot","_ref","_ref2","fixedTopRows","fixedBottomRows","_props$rowKey","rowKey","_tr$getBoundingClient","tr","thisRowInfo","lastRowId","lastRowInfo","defaultBottom","_thead$getBoundingCli","height","_tr$getBoundingClient2","_tfoot$getBoundingCli","updateRowAndColFixedPosition","tableContentElm","clear","querySelector","tbody","shadowLastScrollLeft","updateColumnFixedShadow","target","extra","scrollLeft","skipScrollLimit","isShowRight","clientWidth","scrollWidth","isShowLeft","setIsLastOrFirstFixedCol","t","nodes","colMapInfo","nextColMapInfo","isParentLastLeftFixedCol","lastColMapInfo","isParentFirstRightFixedCol","updateFixedStatus","_getColumnMap","timer","setTimeout","clearTimeout","updateFixedHeader","_tRef$getBoundingClie","tRef","isHeightOverflow","scrollHeight","clientHeight","pos","setTableElmWidth","updateTableWidth","_tableContentRef$curr","_tableContentRef$curr2","_tableElmRef$current","rect","reduceWidth","elmRect","updateAffixPosition","calculateThWidthList","widthMap","updateThWidthList","HTMLCollection","Object","entries","forEach","_ref3","_ref4","updateThWidthListHandler","_tableContentRef$curr3","emitScrollEvent","e","_props$onScrollX","_props$onScrollY","_props$onScroll","onScrollX","onScrollY","onScroll","getThWidthList","_tableContentRef$curr4","updateTableElmWidthOnColumnChange","finalColKeys","preColKeys","reduceKeys","xorWith","rootThWidthList","pick","values","oldTotalWidth","reduce","r","n","contentWidth","widthToReserve","Math","max","useEffect","refreshTable","onResize","useDebounce","addTableResizeObserver","tableElement","window","getIEVersion","ResizeObserver","off","resizeObserver","observe","_resizeObserver$unobs","_resizeObserver$disco","unobserve","disconnect","getScrollbarWidthWithCSS","isWatchResize","hasWindow","hasResizeObserver","on","updateTableAfterColumnResize"],"mappings":"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"}