{"version":3,"file":"useMultiple.js","sources":["../../src/select-input/useMultiple.tsx"],"sourcesContent":["import React, { useRef, MouseEvent } from 'react';\nimport isObject from 'lodash/isObject';\nimport classNames from 'classnames';\nimport { TdSelectInputProps, SelectInputChangeContext, SelectInputKeys, SelectInputValue } from './type';\nimport TagInput, { TagInputValue } from '../tag-input';\nimport { SelectInputCommonProperties } from './interface';\nimport useControlled from '../hooks/useControlled';\nimport useConfig from '../hooks/useConfig';\nimport { InputRef } from '../input';\n\nexport interface RenderSelectMultipleParams {\n  commonInputProps: SelectInputCommonProperties;\n  onInnerClear: (context: { e: MouseEvent<SVGElement> }) => void;\n  popupVisible: boolean;\n  allowInput: boolean;\n}\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  key: 'key',\n  children: 'children',\n};\n\nexport default function useMultiple(props: TdSelectInputProps) {\n  const { value } = props;\n  const { classPrefix } = useConfig();\n  const tagInputRef = useRef<InputRef>();\n  const [tInputValue, setTInputValue] = useControlled(props, 'inputValue', props.onInputChange);\n  const iKeys: SelectInputKeys = { ...DEFAULT_KEYS, ...props.keys };\n\n  const getTags = () => {\n    if (!(value instanceof Array)) {\n      return isObject(value) ? [value[iKeys.label]] : [value];\n    }\n    return value.map((item: SelectInputValue) => (isObject(item) ? item[iKeys.label] : item));\n  };\n  const tags = getTags();\n\n  const tPlaceholder = !tags || !tags.length ? props.placeholder : '';\n\n  const onTagInputChange = (val: TagInputValue, context: SelectInputChangeContext) => {\n    // 避免触发浮层的显示或隐藏\n    if (context.trigger === 'tag-remove') {\n      context.e?.stopPropagation();\n    }\n    props.onTagChange?.(val, context);\n  };\n\n  const renderSelectMultiple = (p: RenderSelectMultipleParams) => (\n    <TagInput\n      ref={tagInputRef}\n      {...p.commonInputProps}\n      autoWidth={props.autoWidth}\n      readonly={props.readonly}\n      minCollapsedNum={props.minCollapsedNum}\n      collapsedItems={props.collapsedItems}\n      tag={props.tag}\n      valueDisplay={props.valueDisplay}\n      placeholder={tPlaceholder}\n      value={tags}\n      inputValue={p.popupVisible && p.allowInput ? tInputValue : ''}\n      onChange={onTagInputChange}\n      onInputChange={(val, context) => {\n        // 筛选器统一特性：筛选器按下回车时不清空输入框\n        if (context?.trigger === 'enter' || context?.trigger === 'blur') return;\n        setTInputValue(val, { trigger: context.trigger, e: context.e });\n      }}\n      tagProps={props.tagProps}\n      onClear={p.onInnerClear}\n      // [Important Info]: SelectInput.blur is not equal to TagInput, example: click popup panel\n      onFocus={(val, context) => {\n        props.onFocus?.(props.value, { ...context, tagInputValue: val });\n      }}\n      {...props.tagInputProps}\n      inputProps={{\n        ...props.inputProps,\n        readonly: !props.allowInput || props.readonly,\n        inputClass: classNames(props.tagInputProps?.className, {\n          [`${classPrefix}-input--focused`]: p.popupVisible,\n          [`${classPrefix}-is-focused`]: p.popupVisible,\n        }),\n      }}\n    />\n  );\n\n  return {\n    tags,\n    tPlaceholder,\n    tagInputRef,\n    multipleInputValue: tInputValue,\n    renderSelectMultiple,\n  };\n}\n"],"names":["DEFAULT_KEYS","label","key","children","useMultiple","props","value","_useConfig","useConfig","classPrefix","tagInputRef","useRef","_useControlled","useControlled","onInputChange","_useControlled2","_slicedToArray","tInputValue","setTInputValue","iKeys","keys","getTags","Array","isObject","map","item","tags","tPlaceholder","length","placeholder","onTagInputChange","val","context","_props$onTagChange","trigger","_context$e","e","stopPropagation","onTagChange","call","renderSelectMultiple","p","_props$tagInputProps","React","createElement","TagInput","_objectSpread","ref","commonInputProps","autoWidth","readonly","minCollapsedNum","collapsedItems","tag","valueDisplay","inputValue","popupVisible","allowInput","onChange","tagProps","onClear","onInnerClear","onFocus","_props$onFocus","tagInputValue","tagInputProps","inputProps","inputClass","classNames","className","_defineProperty","concat","multipleInputValue"],"mappings":"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"}