{"version":3,"file":"useOptions.js","sources":["../../../src/select/hooks/useOptions.ts"],"sourcesContent":["import React, { useState, useEffect, ReactNode, ReactElement } from 'react';\nimport get from 'lodash/get';\nimport { SelectKeysType, SelectOption, SelectValue } from '../type';\nimport { getValueToOption } from '../util/helper';\nimport Option from '../base/Option';\n\n// 处理 options 的逻辑\nfunction UseOptions(\n  keys: SelectKeysType,\n  options: SelectOption[],\n  children: ReactNode,\n  valueType: 'object' | 'value',\n  value: SelectValue<SelectOption>,\n  reserveKeyword: boolean,\n) {\n  const [valueToOption, setValueToOption] = useState({});\n  const [currentOptions, setCurrentOptions] = useState([]);\n  const [tmpPropOptions, setTmpPropOptions] = useState([]);\n  const [selectedOptions, setSelectedOptions] = useState([]);\n\n  // 处理设置 option 的逻辑\n  useEffect(() => {\n    let transformedOptions = options;\n\n    const arrayChildren = React.Children.toArray(children);\n    const optionChildren = arrayChildren.filter((v: ReactElement) => v.type === Option);\n    const isChildrenFilterable = arrayChildren.length > 0 && optionChildren.length === arrayChildren.length;\n    if (reserveKeyword && currentOptions.length && isChildrenFilterable) return;\n\n    if (isChildrenFilterable) {\n      transformedOptions = arrayChildren?.map<SelectOption>((v) => {\n        if (React.isValidElement<SelectOption>(v)) {\n          return {\n            ...v.props,\n            label: v.props.label || v.props.children,\n          };\n        }\n        return { label: v };\n      });\n    }\n    if (keys) {\n      // 如果有定制 keys 先做转换\n      transformedOptions = transformedOptions?.map<SelectOption>((option) => ({\n        ...option,\n        value: get(option, keys?.value || 'value'),\n        label: get(option, keys?.label || 'label'),\n      }));\n    }\n    setCurrentOptions(transformedOptions);\n    setTmpPropOptions(transformedOptions);\n\n    setValueToOption(getValueToOption(children as ReactElement, options as any, keys) || {});\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [options, keys, children, reserveKeyword]);\n\n  // 同步 value 对应的 options\n  useEffect(() => {\n    setSelectedOptions((oldSelectedOptions: SelectOption[]) => {\n      const valueKey = keys?.value || 'value';\n      const labelKey = keys?.label || 'label';\n      if (Array.isArray(value)) {\n        return value\n          .map((item: SelectValue<SelectOption>) => {\n            if (valueType === 'value') {\n              return (\n                valueToOption[item as string | number] ||\n                oldSelectedOptions.find((option) => get(option, valueKey) === item) || {\n                  [valueKey]: item,\n                  [labelKey]: item,\n                }\n              );\n            }\n            return item;\n          })\n          .filter(Boolean);\n      }\n\n      if (value !== undefined && value !== null) {\n        if (valueType === 'value') {\n          return [\n            valueToOption[value as string | number] ||\n              oldSelectedOptions.find((option) => get(option, valueKey) === value) || {\n                [valueKey]: value,\n                [labelKey]: value,\n              },\n          ].filter(Boolean);\n        }\n        return [value];\n      }\n      return [];\n    });\n  }, [value, keys, valueType, valueToOption, setSelectedOptions]);\n\n  return {\n    currentOptions,\n    setCurrentOptions,\n    tmpPropOptions,\n    setTmpPropOptions,\n    valueToOption,\n    setValueToOption,\n    selectedOptions,\n    setSelectedOptions,\n  };\n}\n\nexport default UseOptions;\n"],"names":["UseOptions","keys","options","children","valueType","value","reserveKeyword","_useState","useState","_useState2","_slicedToArray","valueToOption","setValueToOption","_useState3","_useState4","currentOptions","setCurrentOptions","_useState5","_useState6","tmpPropOptions","setTmpPropOptions","_useState7","_useState8","selectedOptions","setSelectedOptions","useEffect","transformedOptions","arrayChildren","React","Children","toArray","optionChildren","filter","v","type","Option","isChildrenFilterable","length","map","isValidElement","_objectSpread","props","label","_transformedOptions","option","get","getValueToOption","oldSelectedOptions","valueKey","labelKey","Array","isArray","item","find","_defineProperty","Boolean"],"mappings":"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"}