{"version":3,"file":"Option.js","sources":["../../../src/select/base/Option.tsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport classNames from 'classnames';\nimport isNumber from 'lodash/isNumber';\nimport isString from 'lodash/isString';\nimport get from 'lodash/get';\n\nimport useConfig from '../../hooks/useConfig';\nimport useDomRefCallback from '../../hooks/useDomRefCallback';\nimport useRipple from '../../_util/useRipple';\nimport { StyledProps } from '../../common';\nimport { SelectValue, TdOptionProps, TdSelectProps, SelectKeysType, SelectOption } from '../type';\n\n/**\n * Option 组件属性\n */\nexport interface SelectOptionProps\n  extends StyledProps,\n    TdOptionProps,\n    Pick<TdSelectProps, 'size' | 'multiple' | 'max'> {\n  selectedValue?: SelectValue;\n  children?: React.ReactNode;\n  onSelect?: (\n    value: string | number,\n    context: {\n      label?: string;\n      selected?: boolean;\n      event: React.MouseEvent<HTMLLIElement>;\n      restData?: Record<string, any>;\n    },\n  ) => void;\n  onCheckAllChange?: (checkAll: boolean, e: React.MouseEvent<HTMLLIElement>) => void;\n  restData?: Record<string, any>;\n  keys?: SelectKeysType;\n  optionLength?: number;\n  isVirtual?: boolean;\n  onRowMounted?: (rowData: { ref: HTMLElement; data: SelectOption }) => void;\n}\n\nconst componentType = 'select';\n\nconst Option: React.FC<SelectOptionProps> = (props) => {\n  const {\n    disabled: propDisabled,\n    label: propLabel,\n    title: propTitle,\n    selectedValue,\n    checkAll,\n    multiple,\n    size,\n    max,\n    keys,\n    value,\n    onSelect,\n    children,\n    content,\n    restData,\n    style,\n    className,\n    isVirtual,\n  } = props;\n\n  let selected: boolean;\n  const label = propLabel || value;\n  const disabled = propDisabled || (multiple && Array.isArray(selectedValue) && max && selectedValue.length >= max);\n\n  const { classPrefix } = useConfig();\n\n  // 使用斜八角动画\n  const [optionRef, setRefCurrent] = useDomRefCallback();\n\n  useEffect(() => {\n    if (isVirtual && optionRef) {\n      props.onRowMounted?.({\n        ref: optionRef,\n        data: props,\n      });\n    }\n    // eslint-disable-next-line\n  }, [isVirtual, optionRef]);\n\n  useRipple(optionRef);\n\n  // 处理单选场景\n  if (!multiple) {\n    selected =\n      isNumber(selectedValue) || isString(selectedValue)\n        ? value === selectedValue\n        : value === get(selectedValue, keys?.value || 'value');\n  }\n  // 处理多选场景\n  if (multiple && Array.isArray(selectedValue)) {\n    selected = selectedValue.some((item) => {\n      if (isNumber(item) || isString(item)) {\n        // 如果非 object 类型\n        return item === value;\n      }\n      return get(item, keys?.value || 'value') === value;\n    });\n    if (props.checkAll) {\n      selected = selectedValue.length === props.optionLength;\n    }\n  }\n\n  const handleSelect = (event: React.MouseEvent<HTMLLIElement>) => {\n    if (!disabled && !checkAll) {\n      onSelect(value, { label: String(label), selected, event, restData });\n    }\n    if (checkAll) {\n      props.onCheckAllChange?.(selected, event);\n    }\n  };\n\n  const renderItem = (children: React.ReactNode) => {\n    if (multiple) {\n      return (\n        <label\n          className={classNames(`${classPrefix}-checkbox`, {\n            [`${classPrefix}-is-disabled`]: disabled,\n            [`${classPrefix}-is-checked`]: selected,\n          })}\n          title={propTitle || (label as string)}\n        >\n          <input\n            type=\"checkbox\"\n            className={classNames(`${classPrefix}-checkbox__former`)}\n            value=\"\"\n            disabled={disabled && !selected}\n            onClick={(e) => {\n              e.stopPropagation();\n              e.nativeEvent.stopImmediatePropagation();\n            }}\n          />\n          <span className={classNames(`${classPrefix}-checkbox__input`)}></span>\n          <span className={classNames(`${classPrefix}-checkbox__label`)}>{children || content || label}</span>\n        </label>\n      );\n    }\n    return <span title={propTitle || (label as string)}>{children || content || label}</span>;\n  };\n\n  return (\n    <li\n      className={classNames(className, `${classPrefix}-${componentType}-option`, {\n        [`${classPrefix}-is-disabled`]: disabled,\n        [`${classPrefix}-is-selected`]: selected,\n        [`${classPrefix}-size-s`]: size === 'small',\n        [`${classPrefix}-size-l`]: size === 'large',\n      })}\n      key={value}\n      onClick={handleSelect}\n      ref={setRefCurrent}\n      style={style}\n    >\n      {renderItem(children)}\n    </li>\n  );\n};\n\nexport default Option;\n"],"names":["componentType","Option","props","propDisabled","disabled","propLabel","label","propTitle","title","selectedValue","checkAll","multiple","size","max","keys","value","onSelect","children","content","restData","style","className","isVirtual","selected","Array","isArray","length","_useConfig","useConfig","classPrefix","_useDomRefCallback","useDomRefCallback","_useDomRefCallback2","_slicedToArray","optionRef","setRefCurrent","useEffect","_props$onRowMounted","onRowMounted","call","ref","data","useRipple","isNumber","isString","get","some","item","optionLength","handleSelect","event","String","_props$onCheckAllChan","onCheckAllChange","renderItem","React","createElement","classNames","concat","_defineProperty","type","onClick","e","stopPropagation","nativeEvent","stopImmediatePropagation","key"],"mappings":"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"}