{"version":3,"file":"inputs.js","sources":["../../../../../src/color-picker/components/panel/format/inputs.tsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport throttle from 'lodash/throttle';\nimport Color from '../../../../_common/js/color-picker/color';\nimport Input from '../../../../input';\nimport InputNumber from '../../../../input-number';\nimport { FORMAT_INPUT_CONFIG } from './config';\n\nconst FormatInputs = (props) => {\n  const { format, enableAlpha, inputProps, disabled, onInputChange, color } = props;\n  const lastModelValue = useRef({});\n  const formatValueRef = useRef<any>({});\n\n  const object2color = (f: string) => Color.object2color(formatValueRef.current, f);\n\n  // 获取不同格式的输入输出值\n  const getFormatColorMap = (type: 'encode' | 'decode') => {\n    if (type === 'encode') {\n      return {\n        HSV: color.getHsva(),\n        HSL: color.getHsla(),\n        RGB: color.getRgba(),\n        CMYK: color.getCmyk(),\n        CSS: {\n          css: color.css,\n        },\n        HEX: {\n          hex: color.hex,\n        },\n      };\n    }\n    // decode\n    return {\n      HSV: object2color('HSV'),\n      HSL: object2color('HSL'),\n      RGB: object2color('RGB'),\n      CMYK: object2color('CMYK'),\n      CSS: formatValueRef.current.css,\n      HEX: formatValueRef.current.hex,\n    };\n  };\n\n  // 更新 modelValue\n  const updateModelValue = () => {\n    const values: any = getFormatColorMap('encode')[format];\n    values.a = Math.round(color.alpha * 100);\n\n    const changedFormatValue = {};\n    Object.keys(values).forEach((key) => {\n      if (values[key] !== formatValueRef.current[key]) {\n        changedFormatValue[key] = values[key];\n      }\n      lastModelValue.current[key] = values[key];\n    });\n\n    if (Object.keys(changedFormatValue).length > 0) {\n      formatValueRef.current = values;\n    }\n  };\n\n  updateModelValue();\n\n  const throttleUpdate = throttle(updateModelValue, 100);\n\n  const inputConfigs = () => {\n    const configs = [...FORMAT_INPUT_CONFIG[format]];\n    if (enableAlpha) {\n      configs.push({\n        type: 'inputNumber',\n        key: 'a',\n        min: 0,\n        max: 100,\n        format: (value: number) => `${value}%`,\n        flex: 1.15,\n      });\n    }\n    return configs;\n  };\n\n  const handleInputChange = (key: string, v: number | string) => {\n    if (v === lastModelValue.current[key]) {\n      return;\n    }\n\n    const newFormatValue = {\n      ...formatValueRef.current,\n      [key]: v,\n    };\n    formatValueRef.current = newFormatValue;\n    lastModelValue.current[key] = v;\n    const value = getFormatColorMap('decode')[format];\n    onInputChange(value, formatValueRef.current.a / 100, key, v);\n  };\n\n  useEffect(() => {\n    throttleUpdate();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [color.saturation, color.hue, color.value, color.alpha, format]);\n\n  return (\n    <div className=\"input-group\">\n      {inputConfigs().map((config) => {\n        const commonProps = {\n          ...inputProps,\n          title: formatValueRef.current[config.key],\n          [config.type === 'input' ? 'defaultValue' : 'value']: formatValueRef.current[config.key],\n          align: 'center',\n          disabled,\n          size: 'small',\n          onChange:\n            config.type === 'input'\n              ? Function.prototype\n              : (v: string) => handleInputChange(config.key, v || config.min),\n          onBlur: (v: string) => handleInputChange(config.key, v),\n          onEnter: (v: string) => handleInputChange(config.key, v),\n        };\n\n        return (\n          <div\n            className=\"input-group__item\"\n            key={config.key}\n            style={{\n              flex: config.flex || 1,\n            }}\n          >\n            {config.type === 'input' ? (\n              <Input {...commonProps} key={commonProps.defaultValue} maxlength={format === 'HEX' ? 9 : undefined} />\n            ) : (\n              <InputNumber\n                {...commonProps}\n                min={config.min}\n                max={config.max}\n                step={1}\n                format={config.format}\n                theme=\"normal\"\n              />\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default React.memo(FormatInputs);\n"],"names":["FormatInputs","props","format","enableAlpha","inputProps","disabled","onInputChange","color","lastModelValue","useRef","formatValueRef","object2color","f","Color","current","getFormatColorMap","type","HSV","getHsva","HSL","getHsla","RGB","getRgba","CMYK","getCmyk","CSS","css","HEX","hex","updateModelValue","values","a","Math","round","alpha","changedFormatValue","Object","keys","forEach","key","length","throttleUpdate","throttle","inputConfigs","configs","_toConsumableArray","FORMAT_INPUT_CONFIG","push","min","max","value","concat","flex","handleInputChange","v","newFormatValue","_objectSpread","_defineProperty","useEffect","saturation","hue","React","createElement","className","map","config","commonProps","title","Function","prototype","onBlur","onEnter","style","Input","defaultValue","maxlength","InputNumber","step","theme","memo"],"mappings":"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"}