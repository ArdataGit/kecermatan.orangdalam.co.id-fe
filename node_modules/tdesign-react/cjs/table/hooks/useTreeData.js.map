{"version":3,"file":"useTreeData.js","sources":["../../../src/table/hooks/useTreeData.tsx"],"sourcesContent":["import React, { MouseEvent, useEffect, useMemo, useState } from 'react';\nimport {\n  AddRectangleIcon as TdAddRectangleIcon,\n  MinusRectangleIcon as TdMinusRectangleIcon,\n} from 'tdesign-icons-react';\nimport get from 'lodash/get';\nimport classNames from 'classnames';\nimport TableTreeStore, { SwapParams } from '../../_common/js/table/tree-store';\nimport { TdEnhancedTableProps, PrimaryTableCol, TableRowData, TableRowValue, TableRowState } from '../type';\nimport useClassName from './useClassName';\nimport { renderCell } from '../Cell';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport useGlobalIcon from '../../hooks/useGlobalIcon';\nimport { parseContentTNode } from '../../_util/parseTNode';\nimport useTreeDataExpand from './useTreeDataExpand';\n\nexport interface UseSwapParams<T> extends SwapParams<T> {\n  data: T[];\n}\n\nexport default function useTreeData(props: TdEnhancedTableProps) {\n  const { data, columns, tree, rowKey, treeExpandAndFoldIcon } = props;\n  const [store] = useState(new TableTreeStore() as InstanceType<typeof TableTreeStore>);\n  const [treeNodeCol, setTreeNodeCol] = useState<PrimaryTableCol>(() => getTreeNodeColumnCol());\n  const [dataSource, setDataSource] = useState<TdEnhancedTableProps['data']>(data || []);\n  const { tableTreeClasses } = useClassName();\n  const [locale, t] = useLocaleReceiver('table');\n  const { AddRectangleIcon, MinusRectangleIcon } = useGlobalIcon({\n    AddRectangleIcon: TdAddRectangleIcon,\n    MinusRectangleIcon: TdMinusRectangleIcon,\n  });\n\n  const rowDataKeys = useMemo(\n    () => ({\n      rowKey: rowKey || 'id',\n      childrenKey: tree?.childrenKey || 'children',\n    }),\n    [rowKey, tree?.childrenKey],\n  );\n\n  const [isDefaultExpandedTreeNodesExecute, setIsDefaultExpandedTreeNodesExecute] = useState(false);\n  const {\n    tExpandedTreeNode,\n    isDefaultExpandAllExecute,\n    expandAll,\n    foldAll,\n    updateExpandOnDataChange,\n    onExpandFoldIconClick,\n  } = useTreeDataExpand(props, { store, dataSource, rowDataKeys, setDataSource });\n\n  const checkedColumn = useMemo(() => columns.find((col) => col.colKey === 'row-select'), [columns]);\n\n  useEffect(() => {\n    if (!store || !checkedColumn) return;\n    // 第一次，不需要执行 updateDisabledState\n    const rowValue = get(dataSource[0], rowDataKeys.rowKey);\n    if (!store.treeDataMap.get(rowValue)) return;\n    store.updateDisabledState(dataSource, checkedColumn, rowDataKeys);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [checkedColumn]);\n\n  useEffect(\n    () => {\n      if (!data || !store) return;\n      // 如果没有树形解构，则不需要相关逻辑\n      if (tree) {\n        resetData(data);\n      } else {\n        setDataSource(data);\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [data],\n  );\n\n  useEffect(\n    () => {\n      const treeNodeColTmp = getTreeNodeColumnCol();\n      setTreeNodeCol(treeNodeColTmp);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [columns, props.tree?.treeNodeColumnIndex],\n  );\n\n  function resetData(data: TableRowData[]) {\n    const { columns, expandedTreeNodes, defaultExpandedTreeNodes } = props;\n    store.initialTreeStore(data, columns, rowDataKeys);\n    const defaultNeedExpand = Boolean(!isDefaultExpandedTreeNodesExecute && defaultExpandedTreeNodes?.length);\n    const needExpandAll = Boolean(tree?.defaultExpandAll && !isDefaultExpandAllExecute);\n    if ((tExpandedTreeNode?.length && !!(expandedTreeNodes || defaultNeedExpand)) || needExpandAll) {\n      updateExpandOnDataChange([...data]);\n      setIsDefaultExpandedTreeNodesExecute(true);\n    } else {\n      setDataSource([...data]);\n    }\n  }\n\n  function getTreeNodeStyle(level: number) {\n    if (level === undefined) return;\n    const indent = props.tree?.indent === undefined ? 24 : props.tree?.indent;\n    // 默认 1px 是为了临界省略\n    return indent ? { paddingLeft: `${level * indent || 1}px` } : {};\n  }\n\n  /**\n   * 对外暴露的组件实例方法，展开或收起某一行\n   * @param p 行数据\n   */\n  function toggleExpandData(p: { row: TableRowData; rowIndex: number }, trigger?: 'expand-fold-icon' | 'row-click') {\n    const currentData = { ...p };\n    // eslint-disable-next-line\n    if (p.row.__VIRTUAL_SCROLL_INDEX !== undefined) {\n      // eslint-disable-next-line\n      currentData.rowIndex = p.row.__VIRTUAL_SCROLL_INDEX;\n    }\n    const newData = store.toggleExpandData(currentData, dataSource, rowDataKeys);\n    setDataSource([...newData]);\n    const rowValue = get(p.row, rowDataKeys.rowKey);\n    props.onTreeExpandChange?.({\n      row: p.row,\n      rowIndex: p.rowIndex,\n      rowState: store?.treeDataMap?.get(rowValue),\n      trigger,\n    });\n  }\n\n  function getTreeNodeColumnCol() {\n    const { columns } = props;\n    let treeNodeColumnIndex = props.tree?.treeNodeColumnIndex || 0;\n    // type 存在，则表示表格内部渲染的特殊列，比如：展开行按钮、复选框、单选按钮等，不能作为树结点列。因此树结点展开列向后顺移\n    while (\n      columns[treeNodeColumnIndex]?.type ||\n      columns[treeNodeColumnIndex]?.colKey === '__EXPAND_ROW_ICON_COLUMN__'\n    ) {\n      treeNodeColumnIndex += 1;\n    }\n    return columns[treeNodeColumnIndex];\n  }\n\n  function formatTreeColumn(col: PrimaryTableCol): PrimaryTableCol {\n    if (!col || !treeNodeCol || !store) return {};\n    if (!props.tree || !Object.keys(props.tree).length || col.colKey !== treeNodeCol.colKey) return col;\n    const newCol = { ...treeNodeCol };\n    newCol.cell = (p) => {\n      const cellInfo = renderCell(\n        { ...p, col: { ...treeNodeCol } },\n        {\n          cellEmptyContent: props.cellEmptyContent,\n        },\n      );\n      const currentState = store.treeDataMap.get(get(p.row, rowDataKeys.rowKey));\n      const colStyle = getTreeNodeStyle(currentState?.level);\n      const classes = { [tableTreeClasses.inlineCol]: !!col.ellipsis };\n      const childrenNodes = get(p.row, rowDataKeys.childrenKey);\n      if ((childrenNodes && childrenNodes instanceof Array) || childrenNodes === true) {\n        const expanded = store.treeDataMap.get(get(p.row, rowDataKeys.rowKey))?.expanded;\n        const type = expanded ? 'fold' : 'expand';\n        const defaultIconNode =\n          t(locale.treeExpandAndFoldIcon, { type }) || (expanded ? <MinusRectangleIcon /> : <AddRectangleIcon />);\n        const iconNode = treeExpandAndFoldIcon\n          ? parseContentTNode(treeExpandAndFoldIcon, { type, ...p })\n          : defaultIconNode;\n        return (\n          <div className={classNames([tableTreeClasses.col, classes])} style={colStyle}>\n            {!!(childrenNodes.length || childrenNodes === true) && (\n              <span\n                className={tableTreeClasses.icon}\n                onClick={(e: MouseEvent<HTMLSpanElement>) => {\n                  onExpandFoldIconClick(p, 'expand-fold-icon');\n                  e.stopPropagation();\n                }}\n              >\n                {iconNode}\n              </span>\n            )}\n            {cellInfo}\n          </div>\n        );\n      }\n      return (\n        <div style={colStyle} className={classNames([classes, tableTreeClasses.leafNode])}>\n          <span className={tableTreeClasses.icon}></span>\n          {cellInfo}\n        </div>\n      );\n    };\n    // 树形节点会显示操作符号 [+] 和 [-]，但省略显示的浮层中不需要操作符\n    if (newCol.ellipsis === true) {\n      newCol.ellipsis = (p) => renderCell({ ...p, col: { ...treeNodeCol } });\n    }\n    return newCol;\n  }\n\n  /**\n   * 对外暴露的组件实例方法，设置行数据，自动刷新界面\n   * @param key 当前行唯一标识值\n   * @param newRowData 新行数据\n   */\n  function setData<T>(key: TableRowValue, newRowData: T) {\n    const rowIndex = store.updateData(key, newRowData, dataSource, rowDataKeys);\n    const newData = [...dataSource];\n    newData[rowIndex] = newRowData;\n    setDataSource([...newData]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，获取当前行全部数据\n   * @param key 行唯一标识\n   * @returns {TableRowState} 当前行数据\n   */\n  function getData(key: TableRowValue): TableRowState {\n    return store.getData(key);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，对外暴露的组件实例方法，移除指定节点\n   * @param key 行唯一标识\n   */\n  function remove(key: TableRowValue) {\n    // 引用传值，可自动更新 dataSource。（dataSource 本是内部变量，可以在任何地方进行任何改变）\n    const newData = store.remove(key, dataSource, rowDataKeys);\n    setDataSource([...newData]);\n  }\n\n  /**\n   * 移除子节点\n   * @param key 行唯一标识\n   */\n  function removeChildren(key: TableRowValue) {\n    const newData = store.removeChildren(key, dataSource, rowDataKeys);\n    setDataSource([...newData]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，为当前节点添加子节点，默认添加到最后一个节点\n   * @param key 当前节点唯一标识\n   * @param newData 待添加的新节点\n   */\n  function appendTo<T>(key: TableRowValue, newData: T | T[]) {\n    if (!key) {\n      setDataSource([...store.appendToRoot(newData, dataSource, rowDataKeys)]);\n      return;\n    }\n    // 引用传值，可自动更新 dataSource。（dataSource 本是内部变量，可以在任何地方进行任何改变）\n    setDataSource([...store.appendTo(key, newData, dataSource, rowDataKeys)]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，当前节点之后，插入节点\n   */\n  function insertAfter<T>(rowValue: TableRowValue, newData: T) {\n    setDataSource([...store.insertAfter(rowValue, newData, dataSource, rowDataKeys)]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，当前节点之后，插入节点\n   */\n  function insertBefore<T>(rowValue: TableRowValue, newData: T) {\n    setDataSource([...store.insertBefore(rowValue, newData, dataSource, rowDataKeys)]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，交换行数据，React 在回掉函数函数中无法获取最新的 state 信息，因此需要参数 params.data\n   */\n  function swapData(params: UseSwapParams<TableRowData>) {\n    const r = store.swapData(params.data, params, rowDataKeys);\n    if (r.result) {\n      setDataSource([...r.dataSource]);\n    } else {\n      const params = {\n        code: r.code,\n        reason: r.reason,\n      };\n      props.onAbnormalDragSort?.(params);\n    }\n  }\n\n  /**\n   * 对外暴露的组件实例方法，获取全部数据的树形结构\n   * @param key 节点唯一标识\n   */\n  function getTreeNode() {\n    return store.getTreeNode(dataSource, rowDataKeys);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，获取树形结构展开的节点\n   */\n  function getTreeExpandedRow(type: 'unique' | 'data' | 'all' = 'data') {\n    return store.getTreeExpandedRow(dataSource, rowDataKeys, type);\n  }\n\n  return {\n    store,\n    rowDataKeys,\n    dataSource,\n    swapData,\n    setData,\n    getData,\n    remove,\n    removeChildren,\n    appendTo,\n    insertAfter,\n    insertBefore,\n    formatTreeColumn,\n    toggleExpandData,\n    expandAll,\n    foldAll,\n    getTreeNode,\n    resetData,\n    getTreeExpandedRow,\n    onExpandFoldIconClick,\n  };\n}\n\nexport type UseTreeDataReturnType = ReturnType<typeof useTreeData>;\n"],"names":["useTreeData","props","_props$tree","data","columns","tree","rowKey","treeExpandAndFoldIcon","_useState","useState","TableTreeStore","_useState2","_slicedToArray","store","_useState3","getTreeNodeColumnCol","_useState4","treeNodeCol","setTreeNodeCol","_useState5","_useState6","dataSource","setDataSource","_useClassName","useClassName","tableTreeClasses","_useLocaleReceiver","useLocaleReceiver","_useLocaleReceiver2","locale","t","_useGlobalIcon","useGlobalIcon","AddRectangleIcon","TdAddRectangleIcon","MinusRectangleIcon","TdMinusRectangleIcon","rowDataKeys","useMemo","childrenKey","_useState7","_useState8","isDefaultExpandedTreeNodesExecute","setIsDefaultExpandedTreeNodesExecute","_useTreeDataExpand","useTreeDataExpand","tExpandedTreeNode","isDefaultExpandAllExecute","expandAll","foldAll","updateExpandOnDataChange","onExpandFoldIconClick","checkedColumn","find","col","colKey","useEffect","rowValue","get","treeDataMap","updateDisabledState","resetData","treeNodeColTmp","treeNodeColumnIndex","expandedTreeNodes","defaultExpandedTreeNodes","initialTreeStore","defaultNeedExpand","Boolean","length","needExpandAll","defaultExpandAll","_toConsumableArray","getTreeNodeStyle","level","_props$tree2","_props$tree3","indent","paddingLeft","concat","toggleExpandData","p","trigger","_props$onTreeExpandCh","_store$treeDataMap","currentData","_objectSpread","row","__VIRTUAL_SCROLL_INDEX","rowIndex","newData","onTreeExpandChange","call","rowState","_props$tree4","_columns2$treeNodeCol","type","_columns2$treeNodeCol2","formatTreeColumn","Object","keys","newCol","cell","cellInfo","renderCell","cellEmptyContent","currentState","colStyle","classes","_defineProperty","inlineCol","ellipsis","childrenNodes","Array","_store$treeDataMap$ge","expanded","defaultIconNode","React","createElement","iconNode","parseContentTNode","className","classNames","style","icon","onClick","e","stopPropagation","leafNode","setData","key","newRowData","updateData","getData","remove","removeChildren","appendTo","appendToRoot","insertAfter","insertBefore","swapData","params","r","result","_props$onAbnormalDrag","code","reason","onAbnormalDragSort","getTreeNode","getTreeExpandedRow"],"mappings":"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"}