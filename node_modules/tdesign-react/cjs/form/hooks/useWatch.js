/**
 * tdesign v1.7.1
 * (c) 2024 tdesign
 * @license MIT
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var slicedToArray = require('../../_chunks/dep-c86b4e2f.js');
var React = require('react');
var get = require('../../_chunks/dep-7c29b5a1.js');
var isUndefined = require('../../_chunks/dep-0f313135.js');
var form_hooks_useForm = require('./useForm.js');
var _util_noop = require('../../_util/noop.js');
require('../../_chunks/dep-2e4b81d6.js');
require('../../_chunks/dep-55437cd3.js');
require('../../_chunks/dep-e7a0e8b4.js');
require('../../_chunks/dep-68d6ca4f.js');
require('../../_chunks/dep-f70c56e2.js');
require('../../_chunks/dep-a4fb1294.js');
require('../../_chunks/dep-59101a1c.js');
require('../../_chunks/dep-315a4a2b.js');
require('../../_chunks/dep-4a411278.js');
require('../../_chunks/dep-9171afa5.js');
require('../../_chunks/dep-7d38d5e1.js');
require('../../_chunks/dep-5ed3b3ae.js');
require('../../_chunks/dep-8bb91473.js');
require('../../_chunks/dep-04f46890.js');
require('../../_chunks/dep-987bfa39.js');
require('../../_chunks/dep-405223a6.js');
require('../../_chunks/dep-ff9a5a06.js');
require('../../_common/js/log/log.js');

function useWatch(name, form) {
  var _useState = React.useState(),
    _useState2 = slicedToArray._slicedToArray(_useState, 2),
    value = _useState2[0],
    setValue = _useState2[1];
  var valueStr = React.useMemo(function () {
    return JSON.stringify(value);
  }, [value]);
  var valueStrRef = React.useRef(valueStr);
  var isValidForm = form && form._init;
  React.useEffect(function () {
    var _form$getInternalHook3, _form$getFieldsValue2;
    if (!isValidForm) return;
    var _form$getInternalHook = (_form$getInternalHook3 = form.getInternalHooks) === null || _form$getInternalHook3 === void 0 ? void 0 : _form$getInternalHook3.call(form, form_hooks_useForm.HOOK_MARK),
      _form$getInternalHook2 = _form$getInternalHook.registerWatch,
      registerWatch = _form$getInternalHook2 === void 0 ? _util_noop["default"] : _form$getInternalHook2;
    var cancelRegister = registerWatch(function () {
      var _form$getFieldsValue;
      var allFieldsValue2 = (_form$getFieldsValue = form.getFieldsValue) === null || _form$getFieldsValue === void 0 ? void 0 : _form$getFieldsValue.call(form, true);
      var newValue = get.get_1(allFieldsValue2, name);
      var nextValueStr = JSON.stringify(newValue);
      if (valueStrRef.current !== nextValueStr) {
        valueStrRef.current = nextValueStr;
        setValue(nextValueStr);
      }
    });
    var allFieldsValue = (_form$getFieldsValue2 = form.getFieldsValue) === null || _form$getFieldsValue2 === void 0 ? void 0 : _form$getFieldsValue2.call(form, true);
    var initialValue = get.get_1(allFieldsValue, name);
    setValue(JSON.stringify(initialValue));
    return cancelRegister;
  }, []);
  return isUndefined.isUndefined_1(value) ? value : JSON.parse(value);
}

exports["default"] = useWatch;
//# sourceMappingURL=useWatch.js.map
