{"version":3,"file":"index.js","sources":["../../../src/form/utils/index.ts"],"sourcesContent":["import type { NamePath } from '../type';\n\n// 获取 formMap 管理的数据\nexport function getMapValue(name: NamePath, formMapRef: React.MutableRefObject<Map<any, any>>) {\n  if (!formMapRef.current) return;\n\n  // 提取所有 map key\n  const mapKeys = [...formMapRef.current.keys()];\n  // 转译为字符串后比对 key 兼容数组格式\n  const key = mapKeys.find((key) => String(key) === String(name));\n  // 拿到 key 引用地址获取 value\n  return formMapRef.current.get(key);\n}\n\n// 将数据整理成对象，数组 name 转化嵌套对象: ['user', 'name'] => { user: { name: '' } }\nexport function calcFieldValue(name: NamePath, value: any) {\n  if (Array.isArray(name)) {\n    const fieldValue = name.reduceRight((prev, curr) => {\n      const arr = [];\n      if (/^\\d+$/.test(String(curr))) arr[curr] = prev;\n      return arr.length ? arr : { [curr]: prev };\n    }, value);\n    return { ...fieldValue };\n  }\n\n  return { [name]: value };\n}\n\n// 通过对象数据类型获取 map 引用: { user: { name: '' } } => formMap.get(['user', 'name'])\nexport function travelMapFromObject(\n  obj: Record<any, any>,\n  formMapRef: React.MutableRefObject<Map<any, any>>,\n  callback: Function,\n) {\n  for (const [mapName, formItemRef] of formMapRef.current.entries()) {\n    // 支持嵌套数据结构\n    if (Array.isArray(mapName)) {\n      // 创建唯一临时变量 symbol\n      const symbol = Symbol('name');\n      let fieldValue = null;\n\n      for (let i = 0; i < mapName.length; i++) {\n        const item = mapName[i];\n        if (Reflect.has(fieldValue || obj, item)) {\n          fieldValue = Reflect.get(fieldValue || obj, item);\n        } else {\n          // 当反射无法获取到值则重置为 symbol\n          fieldValue = symbol;\n          break;\n        }\n      }\n\n      // 非 symbol 说明获取到了值\n      if (fieldValue !== symbol) {\n        callback(formItemRef, fieldValue);\n      }\n    } else if (Reflect.has(obj, mapName)) {\n      callback(formItemRef, obj[mapName]);\n    }\n  }\n}\n"],"names":["getMapValue","name","formMapRef","current","mapKeys","keys","key","find","String","get","calcFieldValue","value","Array","isArray","fieldValue","reduceRight","prev","curr","arr","test","length","_defineProperty","_objectSpread","travelMapFromObject","obj","callback","_iterator","_createForOfIteratorHelper","entries","_step","s","n","done","_step$value","_slicedToArray","mapName","formItemRef","symbol","Symbol","i","item","Reflect","has","err","e","f"],"mappings":"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"}