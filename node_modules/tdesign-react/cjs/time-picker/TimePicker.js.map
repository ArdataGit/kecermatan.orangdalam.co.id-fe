{"version":3,"file":"TimePicker.js","sources":["../../src/time-picker/TimePicker.tsx"],"sourcesContent":["import React, { useState, Ref } from 'react';\nimport classNames from 'classnames';\nimport dayjs from 'dayjs';\nimport customParseFormat from 'dayjs/plugin/customParseFormat';\nimport { TimeIcon as TdTimeIcon } from 'tdesign-icons-react';\n\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport useControlled from '../hooks/useControlled';\nimport useConfig from '../hooks/useConfig';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport noop from '../_util/noop';\n\nimport SelectInput from '../select-input';\nimport type { SelectInputProps, SelectInputValueChangeContext } from '../select-input';\nimport TimeRangePicker from './TimeRangePicker';\nimport TimePickerPanel from './panel/TimePickerPanel';\nimport type { TimePickerPanelProps } from './panel/TimePickerPanel';\n\nimport { useTimePickerTextConfig } from './hooks/useTimePickerTextConfig';\nimport { formatInputValue, validateInputValue } from '../_common/js/time-picker/utils';\nimport { DEFAULT_STEPS, DEFAULT_FORMAT } from '../_common/js/time-picker/const';\nimport { timePickerDefaultProps } from './defaultProps';\n\nimport type { StyledProps } from '../common';\nimport type { TdTimePickerProps } from './type';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\n// https://github.com/iamkun/dayjs/issues/1552\ndayjs.extend(customParseFormat);\n\nexport interface TimePickerProps extends TdTimePickerProps, StyledProps {}\n\nconst TimePicker = forwardRefWithStatics(\n  (originalProps: TimePickerProps, ref: Ref<HTMLDivElement>) => {\n    const props = useDefaultProps<TimePickerProps>(originalProps, timePickerDefaultProps);\n    const TEXT_CONFIG = useTimePickerTextConfig();\n    const {\n      allowInput,\n      borderless,\n      className,\n      clearable,\n      disabled,\n      style,\n      format = DEFAULT_FORMAT,\n      hideDisabledTime = true,\n      steps = DEFAULT_STEPS,\n      placeholder = TEXT_CONFIG.placeholder,\n      disableTime,\n      onBlur = noop,\n      onClose = noop,\n      onFocus = noop,\n      onOpen = noop,\n      onInput = noop,\n      onPick = noop,\n    } = props;\n\n    const [value, onChange] = useControlled(props, 'value', props.onChange);\n\n    const [isPanelShowed, setPanelShow] = useState(false);\n    const [currentValue, setCurrentValue] = useState('');\n\n    const { classPrefix } = useConfig();\n    const { TimeIcon } = useGlobalIcon({\n      TimeIcon: TdTimeIcon,\n    });\n    const name = `${classPrefix}-time-picker`;\n    const inputClasses = classNames(`${name}__group`, {\n      [`${classPrefix}-is-focused`]: isPanelShowed,\n    });\n\n    const effectVisibleCurrentValue = (visible: boolean) => {\n      setPanelShow(visible);\n      setCurrentValue(visible ? value ?? '' : '');\n    };\n\n    const handleShowPopup = (visible: boolean, context: { e: React.MouseEvent<HTMLDivElement, MouseEvent> }) => {\n      effectVisibleCurrentValue(visible);\n      visible ? onOpen(context) : onClose(context); // trigger on-open and on-close\n    };\n\n    const handleClear = (context: { e: React.MouseEvent }) => {\n      const { e } = context;\n      e.stopPropagation();\n      setCurrentValue('');\n      onChange(null);\n    };\n\n    const handleInputChange = (value: string, context: SelectInputValueChangeContext) => {\n      setCurrentValue(value);\n      if (allowInput) {\n        onInput({ value, e: context.e as React.FocusEvent<HTMLInputElement> });\n      }\n    };\n\n    const handleInputBlur: SelectInputProps['onBlur'] = (value, ctx) => {\n      if (allowInput) {\n        const isValidTime = validateInputValue(currentValue, format);\n        if (isValidTime) {\n          onChange(formatInputValue(currentValue, format));\n        }\n      }\n      onBlur({ value: String(value), ...ctx });\n    };\n\n    const handleClickConfirm = () => {\n      const isValidTime = validateInputValue(currentValue, format);\n      if (isValidTime) onChange(currentValue);\n      effectVisibleCurrentValue(false);\n    };\n\n    const handlePanelChange: TimePickerPanelProps['onChange'] = (v, ctx) => {\n      setCurrentValue(v);\n      onPick?.(v, ctx);\n    };\n\n    return (\n      <div className={classNames(name, className)} ref={ref} style={style}>\n        <SelectInput\n          onFocus={onFocus}\n          onClear={handleClear}\n          disabled={disabled}\n          clearable={clearable}\n          allowInput={allowInput}\n          className={inputClasses}\n          borderless={borderless}\n          suffixIcon={<TimeIcon />}\n          popupVisible={isPanelShowed}\n          onInputChange={handleInputChange}\n          onBlur={handleInputBlur}\n          onPopupVisibleChange={handleShowPopup}\n          placeholder={!value ? placeholder : undefined}\n          value={isPanelShowed ? currentValue : value ?? undefined}\n          inputValue={isPanelShowed ? currentValue : value ?? undefined}\n          inputProps={{ ...props.inputProps, size: props.size }}\n          popupProps={{ overlayInnerStyle: { width: 'auto', padding: 0 }, ...props.popupProps }}\n          tips={props.tips}\n          status={props.status}\n          panel={\n            <TimePickerPanel\n              steps={steps}\n              format={format}\n              value={currentValue}\n              isFooterDisplay={true}\n              isShowPanel={isPanelShowed}\n              disableTime={disableTime}\n              onChange={handlePanelChange}\n              onPick={props.onPick}\n              hideDisabledTime={hideDisabledTime}\n              handleConfirmClick={handleClickConfirm}\n              presets={props.presets}\n            />\n          }\n        />\n      </div>\n    );\n  },\n  {\n    TimeRangePicker,\n    TimePickerPanel,\n  },\n);\n\nTimePicker.displayName = 'TimePicker';\n\nexport default TimePicker;\n"],"names":["dayjs","extend","customParseFormat","TimePicker","forwardRefWithStatics","originalProps","ref","props","useDefaultProps","timePickerDefaultProps","TEXT_CONFIG","useTimePickerTextConfig","allowInput","borderless","className","clearable","disabled","style","_props$format","format","DEFAULT_FORMAT","_props$hideDisabledTi","hideDisabledTime","_props$steps","steps","DEFAULT_STEPS","_props$placeholder","placeholder","disableTime","_props$onBlur","onBlur","noop","_props$onClose","onClose","_props$onFocus","onFocus","_props$onOpen","onOpen","_props$onInput","onInput","_props$onPick","onPick","_useControlled","useControlled","onChange","_useControlled2","_slicedToArray","value","_useState","useState","_useState2","isPanelShowed","setPanelShow","_useState3","_useState4","currentValue","setCurrentValue","_useConfig","useConfig","classPrefix","_useGlobalIcon","useGlobalIcon","TimeIcon","TdTimeIcon","name","inputClasses","classNames","concat","_defineProperty","effectVisibleCurrentValue","visible","handleShowPopup","context","handleClear","e","stopPropagation","handleInputChange","handleInputBlur","ctx","isValidTime","validateInputValue","formatInputValue","_objectSpread","String","handleClickConfirm","handlePanelChange","v","React","createElement","SelectInput","onClear","suffixIcon","popupVisible","onInputChange","onPopupVisibleChange","inputValue","inputProps","size","popupProps","overlayInnerStyle","width","padding","tips","status","panel","TimePickerPanel","isFooterDisplay","isShowPanel","handleConfirmClick","presets","TimeRangePicker","displayName"],"mappings":"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"}