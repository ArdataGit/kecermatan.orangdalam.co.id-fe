{"version":3,"file":"Statistic.js","sources":["../../src/statistic/Statistic.tsx"],"sourcesContent":["import React, { forwardRef, useEffect, useImperativeHandle, useMemo, useRef, useState } from 'react';\nimport isNumber from 'lodash/isNumber';\nimport isFunction from 'lodash/isFunction';\nimport {\n  ArrowTriangleDownFilledIcon as TDArrowTriangleDownFilledIcon,\n  ArrowTriangleUpFilledIcon as TDArrowTriangleUpFilledIcon,\n} from 'tdesign-icons-react';\nimport { TdStatisticProps } from './type';\nimport { statisticDefaultProps } from './defaultProps';\nimport { StyledProps } from '../common';\nimport useConfig from '../hooks/useConfig';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport useIsFirstRender from '../hooks/useIsFirstRender';\n\nimport Skeleton from '../skeleton';\nimport Tween from '../_common/js/statistic/tween';\nimport { COLOR_MAP } from '../_common/js/statistic/utils';\n\nexport interface StatisticProps extends TdStatisticProps, StyledProps {}\n\nexport interface StatisticRef {\n  start: (from?: number, to?: number) => void;\n}\n\nconst Statistic = forwardRef<StatisticRef, StatisticProps>((props, ref) => {\n  const {\n    animation,\n    animationStart,\n    color,\n    decimalPlaces,\n    extra,\n    format,\n    loading,\n    prefix,\n    separator,\n    suffix,\n    title,\n    trend,\n    trendPlacement,\n    unit,\n    value,\n  } = useDefaultProps<StatisticProps>(props, statisticDefaultProps);\n  const { classPrefix } = useConfig();\n  const { ArrowTriangleUpFilledIcon } = useGlobalIcon({ ArrowTriangleUpFilledIcon: TDArrowTriangleUpFilledIcon });\n  const { ArrowTriangleDownFilledIcon } = useGlobalIcon({\n    ArrowTriangleDownFilledIcon: TDArrowTriangleDownFilledIcon,\n  });\n\n  /**\n   * init value\n   */\n  const [innerValue, setInnerValue] = useState(animation?.valueFrom ?? value);\n  const numberValue = useMemo(() => (isNumber(value) ? value : 0), [value]);\n  const tween = useRef(null);\n  const isFirstRender = useIsFirstRender();\n\n  const start = (from: number = animation?.valueFrom ?? 0, to: number = numberValue) => {\n    if (from !== to) {\n      tween.current = new Tween({\n        from: {\n          value: from,\n        },\n        to: {\n          value: to,\n        },\n        duration: animation?.duration,\n        onUpdate: (keys) => {\n          setInnerValue(keys.value);\n        },\n        onFinish: () => {\n          setInnerValue(to);\n        },\n      });\n      tween.current?.start();\n    }\n  };\n\n  const formatValue = useMemo(() => {\n    let formatInnerValue: number | string | undefined = innerValue;\n\n    if (isFunction(format)) {\n      return format(formatInnerValue);\n    }\n    const options = {\n      minimumFractionDigits: decimalPlaces || 0,\n      maximumFractionDigits: decimalPlaces || 20,\n      useGrouping: !!separator,\n    };\n    // replace的替换的方案仅能应对大部分地区\n    formatInnerValue = formatInnerValue.toLocaleString(undefined, options).replace(/,|，/g, separator);\n\n    return formatInnerValue;\n  }, [innerValue, decimalPlaces, separator, format]);\n\n  const valueStyle = useMemo(\n    () => ({\n      color: COLOR_MAP[color] || color,\n    }),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [color],\n  );\n\n  useEffect(() => {\n    //  第一次渲染不执行，否则导致初始formValue失效\n    if (isFirstRender) return;\n\n    setInnerValue(value);\n\n    animationStart && animation && start();\n\n    return () => {\n      if (tween.current) {\n        tween.current.stop();\n      }\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [value]);\n\n  useEffect(() => {\n    animationStart && animation && !tween.current && start();\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [animationStart]);\n\n  useImperativeHandle(ref, () => ({\n    start,\n  }));\n\n  const trendIcons = {\n    increase: <ArrowTriangleUpFilledIcon />,\n    decrease: <ArrowTriangleDownFilledIcon />,\n  };\n\n  const trendIcon = trend ? trendIcons[trend] : null;\n\n  const prefixRender = prefix || (trendIcon && trendPlacement !== 'right' ? trendIcon : null);\n  const suffixRender = suffix || (trendIcon && trendPlacement === 'right' ? trendIcon : null);\n\n  return (\n    <div className={`${classPrefix}-statistic`}>\n      {title && <div className={`${classPrefix}-statistic-title`}>{title}</div>}\n      <Skeleton animation=\"gradient\" theme=\"text\" loading={!!loading}>\n        <div className={`${classPrefix}-statistic-content`} style={valueStyle}>\n          {prefixRender && <span className={`${classPrefix}-statistic-content-prefix`}>{prefixRender}</span>}\n          <span className={`${classPrefix}-statistic-content-value`}>{formatValue}</span>\n          {unit && <span className={`${classPrefix}-statistic-content-unit`}>{unit}</span>}\n          {suffixRender && <span className={`${classPrefix}-statistic-content-suffix`}>{suffixRender}</span>}\n        </div>\n      </Skeleton>\n      {extra && <div className={`${classPrefix}-statistic-extra`}>{extra}</div>}\n    </div>\n  );\n});\n\nStatistic.displayName = 'Statistic';\nexport default Statistic;\n"],"names":["Statistic","forwardRef","props","ref","_animation$valueFrom","_useDefaultProps","useDefaultProps","statisticDefaultProps","animation","animationStart","color","decimalPlaces","extra","format","loading","prefix","separator","suffix","title","trend","trendPlacement","unit","value","_useConfig","useConfig","classPrefix","_useGlobalIcon","useGlobalIcon","ArrowTriangleUpFilledIcon","TDArrowTriangleUpFilledIcon","_useGlobalIcon2","ArrowTriangleDownFilledIcon","TDArrowTriangleDownFilledIcon","_useState","useState","valueFrom","_useState2","_slicedToArray","innerValue","setInnerValue","numberValue","useMemo","isNumber","tween","useRef","isFirstRender","useIsFirstRender","start","_animation$valueFrom2","from","arguments","length","undefined","to","_tween$current","current","Tween","duration","onUpdate","keys","onFinish","formatValue","formatInnerValue","isFunction","options","minimumFractionDigits","maximumFractionDigits","useGrouping","toLocaleString","replace","valueStyle","COLOR_MAP","useEffect","stop","useImperativeHandle","trendIcons","increase","decrease","trendIcon","prefixRender","suffixRender","React","createElement","className","Skeleton","theme","style","displayName"],"mappings":"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"}