{"version":3,"file":"ImageViewer.js","sources":["../../src/image-viewer/ImageViewer.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport isFunction from 'lodash/isFunction';\nimport { TdImageViewerProps } from './type';\nimport { ImageModal } from './ImageViewerModal';\nimport { StyledProps, TNode } from '../common';\nimport { imageViewerDefaultProps } from './defaultProps';\nimport useImageScale from './hooks/useImageScale';\nimport useList from './hooks/useList';\nimport useViewerScale from './hooks/useViewerScale';\nimport useControlled from '../hooks/useControlled';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport interface ImageViewerProps extends TdImageViewerProps, StyledProps {}\n\nconst ImageViewer: React.FC<ImageViewerProps> = (originalProps) => {\n  const props = useDefaultProps<ImageViewerProps>(originalProps, imageViewerDefaultProps);\n  const { mode, trigger, images, title, imageScale: imageScaleD, viewerScale: viewerScaleD } = props;\n\n  const [visible, setVisible] = useControlled(props, 'visible', (visible, context) => {\n    isFunction(props.onClose) && props.onClose(context);\n  });\n\n  const [visibled, setVisibled] = useState(false);\n  const list = useList(images);\n  const imageScale = useImageScale(imageScaleD);\n  const viewerScale = useViewerScale(viewerScaleD);\n\n  const isMini = mode === 'modeless';\n\n  const close = (context) => {\n    setVisible(false, context);\n    setTimeout(() => setVisibled(false), 196);\n  };\n\n  const open = () => {\n    if (!images) return;\n    setVisible(true, null);\n    setVisibled(true);\n  };\n  // todo 兼容旧api，新： open close 旧： onOpen, onClose\n  // @ts-ignore TODO 待类型完善后移除\n  const uiImage: TNode = isFunction(trigger) ? trigger({ open, close, onOpen: open, onClose: close }) : trigger;\n\n  return (\n    <>\n      {uiImage}\n      {(visibled || visible) &&\n        createPortal(\n          <ImageModal\n            title={title}\n            visible={visible}\n            images={list}\n            isMini={isMini}\n            imageScale={imageScale}\n            viewerScale={viewerScale}\n            zIndex={props.zIndex}\n            defaultIndex={props.defaultIndex}\n            index={props.index}\n            onIndexChange={props.onIndexChange}\n            draggable={props.draggable}\n            closeOnOverlay={props.closeOnOverlay}\n            closeBtn={props.closeBtn}\n            showOverlay={props.showOverlay}\n            closeOnEscKeydown={props.closeOnEscKeydown}\n            onClose={close}\n            onOpen={open}\n            imageReferrerpolicy={props.imageReferrerpolicy}\n          />,\n          document.body,\n        )}\n    </>\n  );\n};\n\nImageViewer.displayName = 'ImageViewer';\n\nexport default ImageViewer;\n"],"names":["ImageViewer","originalProps","props","useDefaultProps","imageViewerDefaultProps","mode","trigger","images","title","imageScaleD","imageScale","viewerScaleD","viewerScale","_useControlled","useControlled","visible","context","isFunction","onClose","_useControlled2","_slicedToArray","setVisible","_useState","useState","_useState2","visibled","setVisibled","list","useList","useImageScale","useViewerScale","isMini","close","setTimeout","open","uiImage","onOpen","React","createElement","Fragment","createPortal","ImageModal","zIndex","defaultIndex","index","onIndexChange","draggable","closeOnOverlay","closeBtn","showOverlay","closeOnEscKeydown","imageReferrerpolicy","document","body","displayName"],"mappings":"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"}