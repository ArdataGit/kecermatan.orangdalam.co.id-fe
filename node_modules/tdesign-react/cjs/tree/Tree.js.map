{"version":3,"file":"Tree.js","sources":["../../src/tree/Tree.tsx"],"sourcesContent":["import React, {\n  forwardRef,\n  useState,\n  useImperativeHandle,\n  useMemo,\n  RefObject,\n  MouseEvent,\n  useRef,\n  useCallback,\n} from 'react';\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\nimport classNames from 'classnames';\nimport get from 'lodash/get';\n\nimport TreeNode from '../_common/js/tree-v1/tree-node';\nimport { TreeOptionData, StyledProps, ComponentScrollToElementParams } from '../common';\nimport { TreeItemProps } from './interface';\nimport TreeItem from './TreeItem';\nimport log from '../_common/js/log';\n\nimport useControllable from './hooks/useControllable';\nimport { useStore } from './hooks/useStore';\nimport { useTreeConfig } from './hooks/useTreeConfig';\nimport { TreeDraggableContext } from './hooks/TreeDraggableContext';\nimport parseTNode from '../_util/parseTNode';\nimport { usePersistFn } from '../_util/usePersistFn';\nimport useTreeVirtualScroll from './hooks/useTreeVirtualScroll';\n\nimport type { TreeNodeState, TreeNodeValue, TypeTreeNodeData, TypeTreeNodeModel } from '../_common/js/tree-v1/types';\nimport type { TreeInstanceFunctions, TdTreeProps } from './type';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport type TreeProps = TdTreeProps & StyledProps;\n\nconst Tree = forwardRef<TreeInstanceFunctions<TreeOptionData>, TreeProps>((originalProps, ref) => {\n  const { treeClassNames, transitionNames, transitionClassNames, transitionDuration, locale } = useTreeConfig();\n  const props = useDefaultProps<TreeProps>(originalProps, {\n    data: [],\n    expandLevel: 0,\n    icon: true,\n    line: false,\n    transition: true,\n    lazy: true,\n    valueMode: 'onlyLeaf',\n  });\n\n  // 可见节点集合\n  const [visibleNodes, setVisibleNodes] = useState([]);\n\n  const {\n    empty,\n    activable,\n    disabled,\n    checkable,\n    checkProps,\n    disableCheck,\n    hover,\n    icon,\n    line,\n    label,\n    operations,\n    transition, // 动画默认开启\n    expandOnClickNode,\n    onClick,\n    scroll,\n    className,\n    style,\n  } = props;\n\n  const { value, onChange, expanded, onExpand, onActive, actived } = useControllable(props);\n\n  // 国际化文本初始化\n  const emptyText = locale('empty');\n\n  const store = useStore(\n    {\n      ...props,\n      value,\n      onChange,\n      expanded,\n      onExpand,\n      onActive,\n      actived,\n    },\n    initial,\n  );\n\n  function initial() {\n    const nodes = store?.getNodes();\n    const newVisibleNodes = nodes?.filter((node) => node.visible);\n    setVisibleNodes(newVisibleNodes);\n  }\n  // 因为是被 useImperativeHandle 依赖的方法，使用 usePersistFn 变成持久化的。或者也可以使用 useCallback\n  const setExpanded = usePersistFn(\n    (\n      node: TreeNode,\n      isExpanded: boolean,\n      ctx: { e?: MouseEvent<HTMLDivElement>; trigger: 'node-click' | 'icon-click' | 'setItem' },\n    ) => {\n      const { e, trigger } = ctx;\n      const expanded = node.setExpanded(isExpanded);\n      const treeNodeModel = node?.getModel();\n      (e || trigger) && onExpand?.(expanded, { node: treeNodeModel, e, trigger });\n      return expanded;\n    },\n  );\n  const treeRef = useRef(null);\n\n  const {\n    visibleData,\n    isVirtual,\n    treeNodeStyle: virtualTreeNodeStyle,\n    cursorStyle,\n    handleRowMounted,\n    scrollToElement,\n  } = useTreeVirtualScroll({\n    treeRef,\n    scroll,\n    data: visibleNodes,\n  });\n\n  const setActived = usePersistFn(\n    (\n      node: TreeNode,\n      isActived: boolean,\n      ctx: { e?: MouseEvent<HTMLDivElement>; trigger: 'node-click' | 'setItem' },\n    ) => {\n      const actived = node.setActived(isActived);\n      const treeNodeModel = node?.getModel();\n      onActive?.(actived, { node: treeNodeModel, ...ctx });\n      return actived;\n    },\n  );\n\n  const setChecked = usePersistFn(\n    (node: TreeNode, isChecked: boolean, ctx: { e?: any; trigger: 'node-click' | 'setItem' }) => {\n      const checked = node.setChecked(isChecked);\n      const treeNodeModel = node?.getModel();\n      onChange?.(checked, { node: treeNodeModel, ...ctx });\n      return checked;\n    },\n  );\n\n  const handleItemClick: TreeItemProps['onClick'] = (node, options) => {\n    if (!node) {\n      return;\n    }\n    const isDisabled = disabled || node.disabled;\n    const { expand, active, e, trigger } = options;\n    if (expand) setExpanded(node, !node.isExpanded(), { e, trigger });\n\n    if (!isDisabled) {\n      const treeNodeModel = node?.getModel();\n      if (active) {\n        setActived(node, !node.isActived(), { e, trigger: 'node-click' });\n        onClick?.({ node: treeNodeModel, e });\n      } else {\n        onClick?.({ node: treeNodeModel, e });\n      }\n    }\n  };\n\n  const handleChange: TreeItemProps['onChange'] = (node, ctx) => {\n    if (!node || disabled || node.disabled) {\n      return;\n    }\n    setChecked(node, !node.isChecked(), { ...ctx, trigger: 'node-click' });\n  };\n  const handleScrollToElement = useCallback(\n    (params: ComponentScrollToElementParams) => {\n      let { index } = params;\n\n      if (!index && index !== 0) {\n        if (!params.key) {\n          log.error('Tree', 'scrollToElement: one of `index` or `key` must exist.');\n          return;\n        }\n        const data = isVirtual ? visibleData : visibleNodes;\n        index = data?.findIndex((item) => [get(item.data, 'key'), get(item.data, 'value')].includes(params.key));\n        if (index < 0) {\n          log.error('Tree', `${params.key} does not exist in data, check \\`key\\` or \\`data\\` please.`);\n        }\n      }\n      scrollToElement({ ...params, index });\n    },\n    [scrollToElement, isVirtual, visibleData, visibleNodes],\n  );\n  /** 对外暴露的公共方法 * */\n  useImperativeHandle<unknown, TreeInstanceFunctions>(\n    ref,\n    () => ({\n      store,\n      scrollTo: (p: ComponentScrollToElementParams) => handleScrollToElement(p),\n      appendTo(value, newData) {\n        let list = [];\n        if (Array.isArray(newData)) {\n          list = newData;\n        } else {\n          list = [newData];\n        }\n        list.forEach((item) => {\n          store.appendNodes(value, item);\n        });\n      },\n      getIndex(value: TreeNodeValue): number {\n        return store.getNodeIndex(value);\n      },\n      getItem(value: TreeNodeValue): TypeTreeNodeModel {\n        const node: TreeNode = store.getNode(value);\n        return node?.getModel();\n      },\n      getItems(value?: TreeNodeValue): TypeTreeNodeModel[] {\n        const nodes = store.getNodes(value);\n        return nodes.map((node: TreeNode) => node.getModel());\n      },\n      getParent(value: TreeNodeValue): TypeTreeNodeModel {\n        const node = store.getParent(value);\n        return node?.getModel();\n      },\n      getParents(value: TreeNodeValue): TypeTreeNodeModel[] {\n        const nodes = store.getParents(value);\n        return nodes.map((node: TreeNode) => node.getModel());\n      },\n      getPath(value: TreeNodeValue): TypeTreeNodeModel[] {\n        const node = store.getNode(value);\n        let pathNodes = [];\n        if (node) {\n          pathNodes = node.getPath().map((node: TreeNode) => node.getModel());\n        }\n        return pathNodes;\n      },\n      insertAfter(value: TreeNodeValue, newData: TreeOptionData): void {\n        return store.insertAfter(value, newData as TypeTreeNodeData);\n      },\n      insertBefore(value: TreeNodeValue, newData: TreeOptionData): void {\n        return store.insertBefore(value, newData as TypeTreeNodeData);\n      },\n      remove(value: TreeNodeValue): void {\n        return store.remove(value);\n      },\n      setItem(value: TreeNodeValue, options: TreeNodeState): void {\n        const node: TreeNode = this.store.getNode(value);\n        const spec = options;\n        if (node && spec) {\n          if ('expanded' in options) {\n            setExpanded(node, spec.expanded, { trigger: 'setItem' });\n            delete spec.expanded;\n          }\n          if ('actived' in options) {\n            setActived(node, spec.actived, { trigger: 'setItem' });\n            delete spec.actived;\n          }\n          if ('checked' in options) {\n            setChecked(node, spec.checked, { trigger: 'setItem' });\n            delete spec.checked;\n          }\n          node.set(spec);\n        }\n      },\n    }),\n    [store, setExpanded, setActived, setChecked, handleScrollToElement],\n  );\n\n  /* ======== render ======= */\n  // https://github.com/reactjs/react-transition-group/issues/668\n  // CSSTransition 不指定 nodeRef 的时候会使用 findDOMNode 获取 dom\n  // 因为 CSSTransition 是个数组，与 visibleNodes 对应，所以这里根据 visibleNodes 的长度创建 ref 用来保存 dom\n  // visibleNodes 改变的时候，释放上一个 nodeList，防止内存泄漏\n  const nodeList = useMemo<RefObject<HTMLDivElement>[]>(\n    () => visibleNodes.map(() => React.createRef()),\n    [visibleNodes],\n  );\n\n  const renderEmpty = () => parseTNode(empty, null, emptyText);\n\n  const renderItems = (renderNode: TreeNode[]) => {\n    if (renderNode.length <= 0) {\n      return renderEmpty();\n    }\n    if (isVirtual)\n      return (\n        <div className={treeClassNames.treeList} style={virtualTreeNodeStyle}>\n          {renderNode.map((node, index) => (\n            <TreeItem\n              ref={nodeList[index]}\n              key={node.value}\n              node={node}\n              keys={props.keys}\n              empty={empty}\n              icon={icon}\n              label={label}\n              line={line}\n              transition={transition}\n              expandOnClickNode={expandOnClickNode}\n              activable={activable}\n              operations={operations}\n              checkProps={checkProps}\n              disableCheck={disableCheck}\n              onClick={handleItemClick}\n              onChange={handleChange}\n              onTreeItemMounted={handleRowMounted}\n              isVirtual={isVirtual}\n            />\n          ))}\n        </div>\n      );\n\n    return (\n      <TransitionGroup name={transitionNames.treeNode} className={treeClassNames.treeList}>\n        {renderNode.map((node, index) => (\n          // https://github.com/reactjs/react-transition-group/issues/668\n          <CSSTransition\n            nodeRef={nodeList[index]}\n            key={node.value}\n            timeout={transitionDuration}\n            classNames={transitionClassNames}\n          >\n            <TreeItem\n              ref={nodeList[index]}\n              node={node}\n              keys={props.keys}\n              empty={empty}\n              icon={icon}\n              label={label}\n              line={line}\n              transition={transition}\n              expandOnClickNode={expandOnClickNode}\n              activable={activable}\n              operations={operations}\n              checkProps={checkProps}\n              disableCheck={disableCheck}\n              onClick={handleItemClick}\n              onChange={handleChange}\n            />\n          </CSSTransition>\n        ))}\n      </TransitionGroup>\n    );\n  };\n\n  const draggable = useMemo(\n    () => ({\n      props,\n      store,\n    }),\n    [props, store],\n  );\n\n  return (\n    <TreeDraggableContext.Provider value={draggable}>\n      <div\n        className={classNames(treeClassNames.tree, className, {\n          [treeClassNames.disabled]: disabled,\n          [treeClassNames.treeHoverable]: hover,\n          [treeClassNames.treeCheckable]: checkable,\n          [treeClassNames.treeFx]: transition,\n          [treeClassNames.treeBlockNode]: expandOnClickNode,\n          [treeClassNames.treeVscroll]: props.scroll, // 开启虚拟滚动就要有overflow 否则低于 threshold 无法正常运行 scrollto\n        })}\n        style={style}\n        ref={treeRef}\n      >\n        {isVirtual ? (\n          <>\n            <div className={treeClassNames.treeVscrollCursor} style={cursorStyle} />\n            {renderItems(visibleData)}\n          </>\n        ) : (\n          renderItems(visibleNodes)\n        )}\n      </div>\n    </TreeDraggableContext.Provider>\n  );\n});\n\nTree.displayName = 'Tree';\n\nexport default Tree;\n"],"names":["Tree","forwardRef","originalProps","ref","_useTreeConfig","useTreeConfig","treeClassNames","transitionNames","transitionClassNames","transitionDuration","locale","props","useDefaultProps","data","expandLevel","icon","line","transition","lazy","valueMode","_useState","useState","_useState2","_slicedToArray","visibleNodes","setVisibleNodes","empty","activable","disabled","checkable","checkProps","disableCheck","hover","label","operations","expandOnClickNode","onClick","scroll","className","style","_useControllable","useControllable","value","onChange","expanded","onExpand","onActive","actived","emptyText","store","useStore","_objectSpread","initial","nodes","getNodes","newVisibleNodes","filter","node","visible","setExpanded","usePersistFn","isExpanded","ctx","e","trigger","treeNodeModel","getModel","treeRef","useRef","_useTreeVirtualScroll","useTreeVirtualScroll","visibleData","isVirtual","virtualTreeNodeStyle","treeNodeStyle","cursorStyle","handleRowMounted","scrollToElement","setActived","isActived","setChecked","isChecked","checked","handleItemClick","options","isDisabled","expand","active","handleChange","handleScrollToElement","useCallback","params","index","key","log","error","findIndex","item","get","includes","concat","useImperativeHandle","scrollTo","p","appendTo","newData","list","Array","isArray","forEach","appendNodes","getIndex","getNodeIndex","getItem","getNode","getItems","map","getParent","getParents","getPath","pathNodes","insertAfter","insertBefore","remove","setItem","spec","set","nodeList","useMemo","React","createRef","renderEmpty","parseTNode","renderItems","renderNode","length","createElement","treeList","TreeItem","keys","onTreeItemMounted","TransitionGroup","name","treeNode","CSSTransition","nodeRef","timeout","classNames","draggable","TreeDraggableContext","Provider","tree","_defineProperty","treeHoverable","treeCheckable","treeFx","treeBlockNode","treeVscroll","treeVscrollCursor","displayName"],"mappings":"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"}