/**
 * tdesign v1.7.1
 * (c) 2024 tdesign
 * @license MIT
 */

import { _ as _slicedToArray } from '../../_chunks/dep-be37289b.js';
import { useState, useMemo, useRef, useEffect } from 'react';
import { g as get_1 } from '../../_chunks/dep-fdd4f070.js';
import { i as isUndefined_1 } from '../../_chunks/dep-f2dd6554.js';
import { HOOK_MARK } from './useForm.js';
import noop from '../../_util/noop.js';
import '../../_chunks/dep-e0a22ada.js';
import '../../_chunks/dep-08fc9b22.js';
import '../../_chunks/dep-49b9df8b.js';
import '../../_chunks/dep-17c2aa2b.js';
import '../../_chunks/dep-9d4210ce.js';
import '../../_chunks/dep-c3a67e8f.js';
import '../../_chunks/dep-f3bac8f4.js';
import '../../_chunks/dep-dc4499f2.js';
import '../../_chunks/dep-cc3b0635.js';
import '../../_chunks/dep-39d65f32.js';
import '../../_chunks/dep-70de8f55.js';
import '../../_chunks/dep-c2c3c04d.js';
import '../../_chunks/dep-48a2bd8e.js';
import '../../_chunks/dep-8cf947bb.js';
import '../../_chunks/dep-d574012b.js';
import '../../_chunks/dep-1336b163.js';
import '../../_chunks/dep-174657df.js';
import '../../_chunks/dep-9d06ffd4.js';
import '../../_common/js/log/index.js';
import '../../_common/js/log/log.js';

function useWatch(name, form) {
  var _useState = useState(),
    _useState2 = _slicedToArray(_useState, 2),
    value = _useState2[0],
    setValue = _useState2[1];
  var valueStr = useMemo(function () {
    return JSON.stringify(value);
  }, [value]);
  var valueStrRef = useRef(valueStr);
  var isValidForm = form && form._init;
  useEffect(function () {
    var _form$getInternalHook3, _form$getFieldsValue2;
    if (!isValidForm) return;
    var _form$getInternalHook = (_form$getInternalHook3 = form.getInternalHooks) === null || _form$getInternalHook3 === void 0 ? void 0 : _form$getInternalHook3.call(form, HOOK_MARK),
      _form$getInternalHook2 = _form$getInternalHook.registerWatch,
      registerWatch = _form$getInternalHook2 === void 0 ? noop : _form$getInternalHook2;
    var cancelRegister = registerWatch(function () {
      var _form$getFieldsValue;
      var allFieldsValue2 = (_form$getFieldsValue = form.getFieldsValue) === null || _form$getFieldsValue === void 0 ? void 0 : _form$getFieldsValue.call(form, true);
      var newValue = get_1(allFieldsValue2, name);
      var nextValueStr = JSON.stringify(newValue);
      if (valueStrRef.current !== nextValueStr) {
        valueStrRef.current = nextValueStr;
        setValue(nextValueStr);
      }
    });
    var allFieldsValue = (_form$getFieldsValue2 = form.getFieldsValue) === null || _form$getFieldsValue2 === void 0 ? void 0 : _form$getFieldsValue2.call(form, true);
    var initialValue = get_1(allFieldsValue, name);
    setValue(JSON.stringify(initialValue));
    return cancelRegister;
  }, []);
  return isUndefined_1(value) ? value : JSON.parse(value);
}

export { useWatch as default };
//# sourceMappingURL=useWatch.js.map
