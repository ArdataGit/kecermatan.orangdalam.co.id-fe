{"version":3,"file":"Switch.js","sources":["../../src/switch/Switch.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport classNames from 'classnames';\nimport Loading from '../loading';\nimport useConfig from '../hooks/useConfig';\nimport { StyledProps } from '../common';\nimport useCommonClassName from '../_util/useCommonClassName';\nimport { SwitchValue, TdSwitchProps } from './type';\nimport { switchDefaultProps } from './defaultProps';\nimport log from '../_common/js/log';\nimport parseTNode from '../_util/parseTNode';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport type SwitchChangeEventHandler = (value: boolean, event: React.MouseEvent<HTMLButtonElement>) => void;\nexport type SwitchClickEventHandler = SwitchChangeEventHandler;\n\nexport interface SwitchProps<T extends SwitchValue = SwitchValue> extends TdSwitchProps<T>, StyledProps {}\n\nconst Switch = React.forwardRef<HTMLButtonElement, SwitchProps>((originalProps, ref) => {\n  const { classPrefix } = useConfig();\n  const props = useDefaultProps<SwitchProps<SwitchValue>>(originalProps, switchDefaultProps);\n  const { className, value, defaultValue, disabled, loading, size, label, customValue, onChange, ...restProps } = props;\n  const [activeValue = true, inactiveValue = false] = customValue || [];\n\n  const isControlled = typeof value !== 'undefined';\n  const initChecked = defaultValue === activeValue || value === activeValue;\n  const [innerChecked, setInnerChecked] = useState(initChecked);\n\n  const contentNode = React.useMemo<React.ReactNode>(() => {\n    if (Array.isArray(label)) {\n      const [activeContent = '', inactiveContent = ''] = label;\n      const content = innerChecked ? activeContent : inactiveContent;\n      return parseTNode(content, { value });\n    }\n    return parseTNode(label, { value });\n  }, [label, innerChecked, value]);\n\n  const onInternalClick: React.MouseEventHandler<HTMLButtonElement> = (e) => {\n    if (disabled) {\n      return;\n    }\n    !isControlled && setInnerChecked(!innerChecked);\n    const changedValue = !innerChecked ? activeValue : inactiveValue;\n    onChange?.(changedValue, { e });\n  };\n\n  useEffect(() => {\n    if (Array.isArray(customValue) && !customValue.includes(value)) {\n      log.error('Switch', `value is not in customValue: ${JSON.stringify(customValue)}`);\n    }\n    isControlled && setInnerChecked(value === activeValue);\n  }, [value, customValue, activeValue, isControlled]);\n\n  const { SIZE, STATUS } = useCommonClassName();\n  const switchClassName = classNames(\n    `${classPrefix}-switch`,\n    className,\n    {\n      [STATUS.checked]: innerChecked,\n      [STATUS.disabled]: disabled,\n      [STATUS.loading]: loading,\n    },\n    SIZE[size],\n  );\n\n  return (\n    <button\n      {...restProps}\n      type=\"button\"\n      role=\"switch\"\n      disabled={disabled || loading}\n      className={switchClassName}\n      ref={ref}\n      onClick={onInternalClick}\n    >\n      <span className={`${classPrefix}-switch__handle`}>{loading && <Loading loading size=\"small\" />}</span>\n      <div className={`${classPrefix}-switch__content`}>{contentNode}</div>\n    </button>\n  );\n});\n\nSwitch.displayName = 'Switch';\n\nexport default Switch as <T extends SwitchValue = SwitchValue>(\n  props: SwitchProps<T> & React.RefAttributes<HTMLButtonElement>,\n) => React.ReactElement;\n"],"names":["Switch","React","forwardRef","originalProps","ref","_useConfig","useConfig","classPrefix","props","useDefaultProps","switchDefaultProps","className","value","defaultValue","disabled","loading","size","label","customValue","onChange","restProps","_objectWithoutProperties","_excluded","_ref","_ref2","_slicedToArray","_ref2$","activeValue","_ref2$2","inactiveValue","isControlled","initChecked","_useState","useState","_useState2","innerChecked","setInnerChecked","contentNode","useMemo","Array","isArray","_label","_label$","activeContent","_label$2","inactiveContent","content","parseTNode","onInternalClick","e","changedValue","useEffect","includes","log","error","concat","JSON","stringify","_useCommonClassName","useCommonClassName","SIZE","STATUS","switchClassName","classNames","_defineProperty","checked","createElement","_objectSpread","type","role","onClick","Loading","displayName"],"mappings":"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"}